<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"

        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd"
        logicalFilePath="db.changelog-master.xml">

    <changeSet id="2017-07-20:init-struct" author="jaanus">

        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="act_ru_task"/>
            </not>
            <not>
                <tableExists tableName="loan_application"/>
            </not>
        </preConditions>

        <sqlFile path="scripts/activiti.postgres.create.engine.sql" splitStatements="false"/>
        <sqlFile path="scripts/activiti.postgres.create.history.sql" splitStatements="false"/>
        <sqlFile path="scripts/activiti.postgres.create.identity.sql" splitStatements="false"/>

        <sqlFile path="scripts/db.init-struct.sql" splitStatements="false"/>

    </changeSet>

    <changeSet id="2017-08-15:add-first-user" author="jaanus">

        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="0">select count(*) from users</sqlCheck>
        </preConditions>

        <sql>
            insert into users (username, first_name, last_name, password, enabled, dealer_id) values ('testadmin', 'Test', 'Admin', md5('testadmin'),
            true, null);
            insert into user_role values ((select id from users where username='testadmin' limit 1), 'ROLE_ADMIN');
        </sql>
    </changeSet>

    <changeSet id="2017-08-30:frame-agreement" author="ivar">
        <sql>
        	ALTER TABLE loan_application
            DROP COLUMN IF EXISTS depersonalized;
            alter table loan_application add column depersonalized boolean default FALSE;
            
        	ALTER TABLE loan_products
            DROP COLUMN IF EXISTS sms_sign_limit;
            alter table loan_products add column sms_sign_limit numeric;
            
            BEGIN;
            DROP TRIGGER IF EXISTS update_latest_client_loan_app
            ON client_profile;

            DROP TRIGGER IF EXISTS update_client_profile_active
            ON client_profile;

            ALTER TABLE client_profile
            DROP COLUMN IF EXISTS display_pin;
            ALTER TABLE client_profile
            DROP COLUMN IF EXISTS first_name_hidden;
            ALTER TABLE client_profile
            DROP COLUMN IF EXISTS last_name_hidden;
            ALTER TABLE client_profile
            DROP COLUMN IF EXISTS patronymic_hidden;


            ALTER TABLE client_profile
            ADD COLUMN display_pin CHARACTER VARYING(50) NULL;

            ALTER TABLE client_profile
            ADD COLUMN first_name_hidden CHARACTER VARYING(100) NULL;

            ALTER TABLE client_profile
            ADD COLUMN last_name_hidden CHARACTER VARYING(100) NULL;

            ALTER TABLE client_profile
            ADD COLUMN patronymic_hidden CHARACTER VARYING(100) NULL;

            ALTER TABLE client_profile
            ADD COLUMN IF NOT EXISTS frame_agreement_active timestamp NULL;

            UPDATE client_profile
            SET display_pin = pin, first_name_hidden = first_name, last_name_hidden = last_name, patronymic_hidden = patronymic;

            ALTER TABLE client_profile
            ALTER COLUMN display_pin SET NOT NULL;


            CREATE TRIGGER update_client_profile_active
            BEFORE INSERT OR UPDATE ON client_profile
            FOR EACH ROW
            EXECUTE PROCEDURE make_last_client_profile_active();

            CREATE TRIGGER update_latest_client_loan_app
            AFTER INSERT OR UPDATE ON client_profile
            FOR EACH ROW
            EXECUTE PROCEDURE update_latest_client_loan_app();


            CREATE SEQUENCE IF NOT EXISTS frame_agreement_seq;
            CREATE SEQUENCE IF NOT EXISTS frame_agreement_file_seq;
            CREATE TABLE IF NOT EXISTS frame_agreement
            (
            id serial PRIMARY KEY,
            pin VARCHAR(50) NOT NULL,
            ended TIMESTAMP,
            created TIMESTAMP NOT NULL
            );

            CREATE TABLE IF NOT EXISTS public.frame_agreement_file
            (
            id SERIAL PRIMARY KEY,
            frame_agreement_id INT NOT NULL,
            file_name VARCHAR(255) NOT NULL,
            folder VARCHAR(255) NOT NULL,
            type VARCHAR(255) NOT NULL,
            CONSTRAINT frame_agreement_file_frame_agreement_id_fk FOREIGN KEY (frame_agreement_id) REFERENCES frame_agreement (id)
            );

            UPDATE bulk_letter_task_row SET lettertype = 'AGREEMENT' where lettertype = 'PRECONTRACT';
        </sql>
    </changeSet>

    <changeSet id="2017-09-06:task-data-table" author="risto">

        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="task_data"/>
            </not>
        </preConditions>

        <createTable tableName="task_data">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="assignee" type="varchar(50)"/>
            <column name="created" type="timestamp" defaultValueComputed="now()"/>
            <column name="notified" type="boolean" defaultValueBoolean="false"/>
            <column name="notified_overdue" type="boolean" defaultValueBoolean="false"/>
            <column name="task_id" type="varchar(15)"/>
        </createTable>

    </changeSet>

    <changeSet id="2017-09-05:create-signing-code" author="oleg">

        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="signing_code"/>
            </not>
        </preConditions>

        <sql>
            create table signing_code (
            id serial NOT NULL,
            loan_app_id integer NOT NULL,
            key varchar(32) NOT NULL,
            code varchar(6) NOT NULL,
            attempt_nr integer default 0 NOT NULL,
            created timestamp default current_timestamp NOT NULL,
            expired boolean default false,
            primary key (id),
            unique (loan_app_id, key));
        </sql>
    </changeSet>

    <changeSet id="2017-10-04:add-reminder-sms" author="oleg">

        <preConditions onFail="MARK_RAN">
            <tableExists tableName="installment_table"/>
        </preConditions>

        <sql>
            alter table installment_table add column IF NOT EXISTS first_rem_sms numeric default 0,
            add column IF NOT EXISTS first_rem_sms_date timestamp,
            add column IF NOT EXISTS second_rem_sms numeric default 0,
            add column IF NOT EXISTS second_rem_sms_date timestamp,
            add column IF NOT EXISTS third_rem_sms numeric default 0,
            add column IF NOT EXISTS third_rem_sms_date timestamp,
            add column IF NOT EXISTS fourth_rem_sms numeric default 0,
            add column IF NOT EXISTS fourth_rem_sms_date timestamp,
            add column IF NOT EXISTS fifth_rem_sms numeric default 0,
            add column IF NOT EXISTS fifth_rem_sms_date timestamp;

            alter table installment_table drop column IF EXISTS  reminder_nr;

            create index IF NOT EXISTS index_installment_table_first_rem_sms on installment_table (first_rem_sms);
            create index IF NOT EXISTS index_installment_table_first_rem_sms_date on installment_table (first_rem_sms_date);
            create index IF NOT EXISTS index_installment_table_second_rem_sms on installment_table (second_rem_sms);
            create index IF NOT EXISTS index_installment_table_second_rem_sms_date on installment_table (second_rem_sms_date);
            create index IF NOT EXISTS index_installment_table_third_rem_sms on installment_table (third_rem_sms);
            create index IF NOT EXISTS index_installment_table_third_rem_sms_date on installment_table (third_rem_sms_date);
            create index IF NOT EXISTS index_installment_table_fourth_rem_sms on installment_table (fourth_rem_sms);
            create index IF NOT EXISTS index_installment_table_fourth_rem_sms_date on installment_table (fourth_rem_sms_date);
            create index IF NOT EXISTS index_installment_table_fifth_rem_sms on installment_table (fifth_rem_sms);
            create index IF NOT EXISTS index_installment_table_fifth_rem_sms_date on installment_table (fifth_rem_sms_date);

            update doc_template set type = 'fifth_reminder_sms' where type = 'fourth_reminder_sms';
            update doc_template set type = 'fourth_reminder_sms' where type = 'third_reminder_sms';
            update doc_template set type = 'third_reminder_sms' where type = 'second_reminder_sms';
            update doc_template set type = 'second_reminder_sms' where type = 'first_reminder_sms';
            update doc_template set type = 'first_reminder_sms' where type = 'payment_reminder_sms';

            update overdue_action set action_name = '5th reminder SMS' where action_name = 'Temination SMS';
        </sql>
    </changeSet>

    <changeSet id="2017-10-04:reminder-sms-update" author="oleg">

        <preConditions onFail="MARK_RAN">
            <tableExists tableName="overdue_action"/>
        </preConditions>

        <sql>
            update overdue_action set action_name = '5th reminder SMS' where action_name = 'Termination reminder SMS';
            update overdue_action set action_name = '4th reminder SMS' where action_name = 'Third reminder SMS';
            update overdue_action set action_name = '3rd reminder SMS' where action_name = 'Second reminder SMS';
            update overdue_action set action_name = '2nd reminder SMS' where action_name = 'First reminder SMS';
            update overdue_action set action_name = '1st reminder SMS' where action_name = 'Payment day SMS days';
        </sql>
    </changeSet>

    <changeSet id="2017-10-09:views-functions-update" author="oleg">

        <sqlFile path="scripts/09-10-2017-views-functions-update.sql" splitStatements="false"/>

    </changeSet>
    <changeSet id="2017-10-11:aftersale-reminder-call-report" author="oleg">

        <preConditions onFail="MARK_RAN">
            <tableExists tableName="call_task"/>
        </preConditions>

        <sqlFile path="scripts/ICE-222-reminderaftersale_call_report.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2017-10-04:timelog-for-methods-calls" author="ivar">
        <createTable tableName="timelog">
            <column name="created" type="timestamp" defaultValue="now()"/>
            <column name="method" type="text"/>
            <column name="ms" type="bigint"/>
        </createTable>

    </changeSet>

    <changeSet id="2017-10-05:add-indexes" author="ivar">
    <preConditions onFail="MARK_RAN">
    	<indexExists indexName="idx_loan_app_data_check_loan_app"/>
        <indexExists indexName="idx_client_history_pin"/>
        <indexExists indexName="idx_employer_reg_code"/>
        <indexExists indexName="idx_client_profile_employer"/>
        <indexExists indexName="idx_client_profile_home_phone"/>
        <indexExists indexName="idx_client_profile_home_work"/>
        <indexExists indexName="idx_client_profile_gsm"/>
        <indexExists indexName="idx_alternative_contact_client"/>
        <indexExists indexName="idx_alternative_contact_phone"/>
        <indexExists indexName="idx_agricultural_asset_client"/>
       <!--  <indexExists indexName="NC-U-y" /> -->
     <!--    <createIndex tableName="loan_app_data_check" indexName="idx_loan_app_data_check_loan_app">
            <column name="loan_app_id"></column>
        </createIndex>
        <createIndex tableName="client_history" indexName="idx_client_history_pin">
            <column name="pin"></column>
        </createIndex>
        <createIndex tableName="employer" indexName="idx_employer_reg_code">
            <column name="reg_code"></column>
        </createIndex>
        <createIndex tableName="client_profile" indexName="idx_client_profile_employer">
            <column name="employer_id"></column>
        </createIndex>
        <createIndex tableName="client_profile" indexName="idx_client_profile_home_phone">
            <column name="phone_home"></column>
        </createIndex>
        <createIndex tableName="client_profile" indexName="idx_client_profile_home_work">
            <column name="phone_work"></column>
        </createIndex>
        <createIndex tableName="client_profile" indexName="idx_client_profile_gsm">
            <column name="gsm"></column>
        </createIndex>
        <createIndex tableName="alternative_contact" indexName="idx_alternative_contact_client">
            <column name="client_id"></column>
        </createIndex>
        <createIndex tableName="alternative_contact" indexName="idx_alternative_contact_phone">
            <column name="phone"></column>
        </createIndex>
        <createIndex tableName="agricultural_asset" indexName="idx_agricultural_asset_client">
            <column name="client_id"></column>
        </createIndex> -->
    </preConditions>
    <dropIndex tableName="loan_app_data_check" indexName="idx_loan_app_data_check_loan_app" />
    <dropIndex tableName="client_history" indexName="idx_client_history_pin" />
    <dropIndex tableName="employer" indexName="idx_employer_reg_code" />
    <dropIndex tableName="client_profile" indexName="idx_client_profile_employer" />
    <dropIndex tableName="client_profile" indexName="idx_client_profile_home_phone" />
    <dropIndex tableName="client_profile" indexName="idx_client_profile_home_work" />
    <dropIndex tableName="client_profile" indexName="idx_client_profile_gsm" />
    <dropIndex tableName="alternative_contact" indexName="idx_alternative_contact_client" />
    <dropIndex tableName="alternative_contact" indexName="idx_alternative_contact_phone" />
    <dropIndex tableName="agricultural_asset" indexName="idx_agricultural_asset_client" />
       
    </changeSet>

    <changeSet id="2017-10-05:reminder_letter_print_date" author="argo">

        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="bulk_letter_task_row" columnName="printed_date"/>
            </not>
        </preConditions>

        <addColumn tableName="bulk_letter_task_row">
            <column name="printed_date" type="date"/>
        </addColumn>

    </changeSet>

    <changeSet id="2017-10-19:ff4j schema" author="ivar">
        <sql>
            CREATE TABLE IF NOT EXISTS ff4j_features (
            feat_uid VARCHAR(100),
            enable INTEGER NOT NULL,
            description VARCHAR(1000),
            strategy VARCHAR(1000),
            expression VARCHAR(255),
            groupname VARCHAR(100),
            PRIMARY KEY (feat_uid)
            );

            CREATE TABLE IF NOT EXISTS ff4j_roles (
            feat_uid VARCHAR(100) REFERENCES ff4j_features (feat_uid),
            role_name VARCHAR(100),
            PRIMARY KEY (feat_uid, role_name)
            );

            CREATE TABLE IF NOT EXISTS ff4j_custom_properties (
            property_id VARCHAR(100) NOT NULL,
            clazz VARCHAR(255) NOT NULL,
            currentvalue VARCHAR(255),
            fixedvalues VARCHAR(1000),
            description VARCHAR(1000),
            feat_uid VARCHAR(100) REFERENCES ff4j_features (feat_uid),
            PRIMARY KEY (property_id, feat_uid)
            );

            CREATE TABLE IF NOT EXISTS ff4j_properties (
            property_id VARCHAR(100) NOT NULL,
            clazz VARCHAR(255) NOT NULL,
            currentvalue VARCHAR(255),
            fixedvalues VARCHAR(1000),
            description VARCHAR(1000),
            PRIMARY KEY (property_id)
            );

            CREATE TABLE IF NOT EXISTS ff4j_audit (
            evt_uuid VARCHAR(40) NOT NULL,
            evt_time TIMESTAMP NOT NULL,
            evt_type VARCHAR(30) NOT NULL,
            evt_name VARCHAR(100) NOT NULL,
            evt_action VARCHAR(100) NOT NULL,
            evt_hostname VARCHAR(100) NOT NULL,
            evt_source VARCHAR(30) NOT NULL,
            evt_duration INTEGER,
            evt_user VARCHAR(30),
            evt_value VARCHAR(100),
            evt_keys VARCHAR(255),
            PRIMARY KEY (evt_uuid, evt_time)
            );

        </sql>
    </changeSet>
    <changeSet id="2017-10-19:exampleFeatureToggle" author="ivar">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('hello', 0, 'Example feature for implementing feature toggles', null, null,
            NULL);
        </sql>
    </changeSet>

    <changeSet id="2017-10-24:remove_client_profile_triggers" author="ivar">
        <sql>
            DROP TRIGGER IF EXISTS update_latest_client_loan_app
            ON client_profile;

            DROP TRIGGER IF EXISTS update_client_profile_active
            ON client_profile;
        </sql>
    </changeSet>


    <changeSet id="2017-10-24:update_client_profile_triggers" author="ivar">
        <sql>
            CREATE TRIGGER update_client_profile_active
            BEFORE INSERT OR UPDATE ON client_profile
            FOR EACH ROW
            EXECUTE PROCEDURE make_last_client_profile_active();

            CREATE TRIGGER update_latest_client_loan_app
            AFTER INSERT OR UPDATE ON client_profile
            FOR EACH ROW
            EXECUTE PROCEDURE update_latest_client_loan_app();
        </sql>
    </changeSet>


    <changeSet id="2017-10-24:trigger-fix" author="ivar">
        <sql splitStatements="false"><![CDATA[

            DROP TRIGGER IF EXISTS update_latest_client_loan_app
            ON client_profile;

            DROP TRIGGER IF EXISTS update_client_profile_active
            ON client_profile;


            UPDATE client_profile c
            SET active = FALSE FROM (
                                        SELECT
                                              count(active) AS c
                                            , max(id)       AS id
                                            , pin
                                        FROM client_profile
                                        WHERE active = TRUE
                                        GROUP BY pin) AS s
            WHERE s.c > 1 AND s.pin = c.pin AND c.id <> s.id and c.active=TRUE ;

            drop FUNCTION  make_last_client_profile_active();

            create function make_last_client_profile_active() returns trigger
            LANGUAGE plpgsql
            AS $$
            DECLARE
                ri                  RECORD;
                oldValue            TEXT;
                newValue            TEXT;
                isColumnSignificant BOOLEAN;
                isValueModified     BOOLEAN;
            BEGIN
                -- based on http://crafted-software.blogspot.com.ee/2011/05/hoorah-i-was-able-to-complete-my.html

                IF (TG_OP <> 'INSERT')
                THEN -- If operation is an INSERT, we have no OLD value, so use an empty string.

                    FOR ri IN
                        -- Fetch a ResultSet listing columns defined for this trigger's table.
                    SELECT
                        ordinal_position,
                        column_name,
                        data_type
                    FROM information_schema.columns
                    WHERE
                        table_schema = quote_ident(TG_TABLE_SCHEMA)
                        AND table_name = quote_ident(TG_TABLE_NAME)
                    ORDER BY ordinal_position
                    LOOP
                        -- For each column in this trigger's table, copy the OLD & NEW values into respective variables.
                        -- NEW value
                        EXECUTE 'SELECT ($1).' || ri.column_name || '::text'
                        INTO newValue
                        USING NEW;

                        -- OLD value
                        EXECUTE 'SELECT ($1).' || ri.column_name || '::text'
                        INTO oldValue
                        USING OLD;

                        isColumnSignificant := (ri.column_name <> 'id') AND (ri.column_name <> 'active');
                        IF isColumnSignificant
                        THEN
                            isValueModified := oldValue <> newValue OR isValueModified; -- If this nthField in the table was modified, make history.
                        END IF;
                    END LOOP;
                END IF;

                IF isValueModified AND NEW.created :: DATE <> CURRENT_DATE AND NEW.editing_user <> 'fix'
                THEN
                    RAISE 'Client profiles can be changed only on the creation day by the user who created the profile . Profile id: %', NEW.id;
                END IF;

                IF NEW.active = TRUE
                THEN
                    UPDATE client_profile cp
                    SET active = FALSE
                    WHERE cp.pin = NEW.pin AND cp.id <> NEW.id;
                END IF;

                RETURN NEW;

            END
            $$;

            CREATE TRIGGER update_client_profile_active
            BEFORE INSERT OR UPDATE ON client_profile
            FOR EACH ROW
            EXECUTE PROCEDURE make_last_client_profile_active();

            CREATE TRIGGER update_latest_client_loan_app
            AFTER INSERT OR UPDATE ON client_profile
            FOR EACH ROW
            EXECUTE PROCEDURE update_latest_client_loan_app();
            ]]>
        </sql>
    </changeSet>


    <changeSet id="2017-10-24:add_attorney_columns_to_users" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="users" columnName="attorney_number"/>
            </not>
            <not>
                <columnExists tableName="users" columnName="attorney_date"/>
            </not>
        </preConditions>

        <addColumn tableName="users">
            <column name="attorney_number" type="varchar(20)"/>
            <column name="attorney_date" type="date"/>
        </addColumn>
    </changeSet>

    <changeSet id="2017-10-27:add_data_verification_mandatory_option_to_loan_product" author="ivar">
        <sql>           
        	ALTER TABLE loan_products ADD COLUMN IF NOT EXISTS requires_data_verification boolean default false;
        </sql>
    </changeSet>

    <changeSet id="2017-10-16:eshop-api-update" author="oleg">

        <preConditions onFail="MARK_RAN">
            <tableExists tableName="dealer"/>
            <tableExists tableName="users"/>
        </preConditions>

        <sql>
            ALTER TABLE dealer ADD COLUMN IF NOT EXISTS eshop_product_id INTEGER;
            ALTER TABLE users ADD COLUMN IF NOT EXISTS eshop_response_type VARCHAR(16);
        </sql>
    </changeSet>

    <changeSet id="2017-10-16:fix-mintod-portfolio-id" author="argo">

        <preConditions onFail="MARK_RAN">
            <tableExists tableName="mintos_portfolio"/>
        </preConditions>

        <sql>
            BEGIN;
            -- protect against concurrent inserts while you update the counter
            LOCK TABLE mintos_portfolio IN EXCLUSIVE MODE;
            -- Update the sequence
            SELECT setval('mintos_portfolio_id_seq', COALESCE((SELECT MAX(id)+1 FROM mintos_portfolio), 1), false);
            COMMIT;
        </sql>
    </changeSet>

    <changeSet id="2017-11-01:reportsMenuToggle" author="ivar">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('reportsMenu', 0, 'Hide reports main menu', NULL, NULL, NULL);
        </sql>
    </changeSet>
    <changeSet id="2017-11-01:redescribeMenuFeatureToggle" author="ivar">
        <sql>UPDATE ff4j_features set description='Show reports top level menu' where feat_uid = 'reportsMenu';</sql>
    </changeSet>

    <changeSet id="2017-11-01:dealerVideo" author="ivar">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('dealerVideo', 0, 'Show dealer video in dealer interface', NULL, NULL, NULL);
        </sql>
    </changeSet>


    <changeSet id="2017-11-02:add_supervised_dealer_column" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="users" columnName="supervised_dealer_id"/>
            </not>
        </preConditions>

        <sql>
            alter table users
            add column supervised_dealer_id integer,
            add constraint fk_supervised_dealer_user
            foreign key (supervised_dealer_id)
            references dealer (id);
        </sql>
    </changeSet>


    <changeSet id="2017-11-15:loan_approval_date" author="risto">

        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="loan_application" columnName="approval_date"/>
            </not>
        </preConditions>

        <addColumn tableName="loan_application">
            <column name="approval_date" type="timestamp"/>
        </addColumn>

    </changeSet>

    <changeSet id="2017-11-15:update-approval-date-for-old-loans" author="risto">
        <sql>
            with approval as (
            select max(generated) as approval_date, loan_app_id from loan_status where status = 'approved' group by loan_app_id
            )
            update loan_application la set approval_date = coalesce(app.approval_date, la.active_date)
            from approval as app
            where app.loan_app_id = la.id and (la.active = true or (la.active = false and la.status in ('approved','normal')));
        </sql>
    </changeSet>

    <changeSet id="2017-11-17:birthplace-for-kosovo" author="ivar">
        <sql>
            ALTER TABLE client_profile ADD COLUMN IF NOT EXISTS birth_place VARCHAR(50);
        </sql>
    </changeSet>

    <changeSet id="2017-10-10:written-off-logic-change" author="jaanus">

        <sqlFile path="scripts/written-off-logic-change.sql" splitStatements="false"/>

    </changeSet>

    <changeSet id="2017-10-30:written-off-logic-fixes" author="jaanus">

        <sqlFile path="scripts/written-off-logic-fixes.sql" splitStatements="false"/>

    </changeSet>

    <changeSet id="2017-11-17:pledgePortfolioFeatureToggle" author="argo">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('pledgePortfolio', 0, 'Activate /pledge/portfolio endpoint', NULL, NULL,NULL);
        </sql>
    </changeSet>

    <changeSet id="2017-12-04:campaign module" author="oleg">
	        <createTable tableName="loan_product_campaign">
	            <column name="id" autoIncrement="true" type="bigint">
	                <constraints primaryKey="true" nullable="false"/>
	            </column>
	            <column name="loan_product_id" type="bigint">
	                <constraints foreignKeyName="id" references="loan_products"/>
	            </column>
	            <column name="active" type="boolean"/>
	            <column name="name" type="text"/>
	            <column name="description" type="text"/>
	            <column name="start_date" type="timestamp"/>
	            <column name="end_date" type="timestamp"/>
	            <column name="max_loan_amount" type="numeric"/>
	        </createTable>
	        <createTable tableName="loan_product_campaign_condition">
	            <column name="id" autoIncrement="true" type="bigint">
	                <constraints primaryKey="true" nullable="false"/>
	            </column>
	            <column name="loan_product_campaign_id" type="bigint">
	                <constraints foreignKeyName="id" references="loan_product_campaign" nullable="false"/>
	            </column>
	            <column name="period" type="int"/>
	            <column name="interest_perc" type="numeric"/>
	            <column name="commission_perc" type="numeric"/>
	        </createTable> 
    </changeSet>

    <changeSet id="2018-01-31:campaign module update" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="loan_application" columnName="loan_product_campaign_id"/>
            </not>
        </preConditions>
        <addColumn tableName="loan_application">
            <column name="loan_product_campaign_id" type="bigint">
                <constraints foreignKeyName="loan_product_campaign_id" references="loan_product_campaign(id)"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2017-12-20:updateSmsMessageLength" author="risto">
        <sql>
            ALTER TABLE smsmessages ALTER COLUMN text TYPE varchar(1000);
        </sql>
    </changeSet>

    <changeSet id="2018-01-09:dealer_repayment_id" author="risto">

        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="dealer_repayments" columnName="repayment_id"/></not>
        </preConditions>

        <addColumn tableName="dealer_repayments">
            <column name="repayment_id" type="integer"/>
        </addColumn>

    </changeSet>

    <changeSet id="2018-01-16:get-sales-report-fixes" author="oleg">
        <sqlFile path="scripts/get-sales-report-fixes.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-01-17:get-sales-report-fixes2" author="risto">
        <sqlFile path="scripts/get-sales-report-fixes2.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-01-17:get-sales-report-fixes3" author="risto">
        <sqlFile path="scripts/get-sales-report-fixes3.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2017-12-08:s3fileStorage" author="ivar">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('S3MoveOldFiles', 0, 'Move old files to Amazon S3', NULL, NULL, NULL);
        </sql>
    </changeSet>

    <changeSet id="2017-12-22:renameFrameAgreementFileTypeColumn" author="ivar">
        <renameColumn tableName="frame_agreement_file" oldColumnName="type" newColumnName="file_type"/>
    </changeSet>

    <changeSet id="2017-12-27:addS3pathColumns" author="ivar">
        <addColumn tableName="frame_agreement_file"><column name="s3path" type="text"/></addColumn>
        <addColumn tableName="loan_app_file"><column name="s3path" type="text"/></addColumn>
        <addColumn tableName="client_file"><column name="s3path" type="text"/></addColumn>
        <addColumn tableName="card_file"><column name="s3path" type="text"/></addColumn>
    </changeSet>

    <changeSet id="2018-01-03:addFrameAgreementCreatedColumn" author="ivar">
        <addColumn tableName="frame_agreement_file">
            <column name="created" type="TIMESTAMP"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-01-08:alterFrameAgreementFileColumn" author="ivar">
        <dropNotNullConstraint tableName="frame_agreement_file" columnName="folder" />
    </changeSet>

    <changeSet id="2017-12-27:adds3processErrorColumns" author="ivar">
        <addColumn tableName="frame_agreement_file"><column name="s3process_error" type="text"/></addColumn>
        <addColumn tableName="loan_app_file"><column name="s3process_error" type="text"/></addColumn>
        <addColumn tableName="client_file"><column name="s3process_error" type="text"/></addColumn>
        <addColumn tableName="card_file"><column name="s3process_error" type="text"/></addColumn>
    </changeSet>


    <changeSet id="2018-01-18:unique-index-for-installment-table" author="risto">
        <sql>
            CREATE UNIQUE INDEX unique_nr ON installment_table (nr, loan_app_id);
        </sql>
    </changeSet>

    <changeSet id="2018-01-18:get-indebtcollection-fixes" author="oleg">
        <sqlFile path="scripts/get-indebtcollection-fixes.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-01-22:get-defaulted-apps-bytermdate-fix" author="oleg">
        <sqlFile path="scripts/22-01-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-01-24:add-fff-albania" author="ivar" context="albania">
        <sqlFile path="scripts/insert-FFF-albania.sql"/>
    </changeSet>
    <changeSet id="2018-01-24:add-fff-macedonia" author="ivar" context="macedonia">
        <sqlFile path="scripts/insert-FFF-macedonia.sql"/>
    </changeSet>

    <changeSet id="2018-01-26:portfolio-to-paid-out-from-active" author="risto">
        <sqlFile path="scripts/26-01-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-01-30:date-update-for-reports" author="risto">
        <sqlFile path="scripts/30-01-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-02-01:ref_nr_to_sequence" author="ivar">
        <sql>CREATE SEQUENCE loan_app_ref_nr ;
            SELECT setval('loan_app_ref_nr', max(ref_nr)+1) FROM loan_application;</sql>
    </changeSet>

    <changeSet id="2018-02-06:add-car-pledge" author="ivar" context="moldova">
        <sqlFile path="scripts/ICM-097-car-loan.sql"/>
    </changeSet>

    <changeSet id="2018-02-07:add-car-dealer" author="ivar" context="moldova">
        <sqlFile path="scripts/ICM-097-car-dealer-loan.sql"/>
    </changeSet>

    <changeSet id="2018-02-20:campaign module update" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="loan_product_campaign" columnName="employment_type"/>
            </not>
        </preConditions>
        <addColumn tableName="loan_product_campaign">
            <column name="employment_type" type="varchar(500)" />
        </addColumn>
    </changeSet>


    <changeSet id="2018-02-06:add-car-pledge" author="ivar" context="moldova">
        <sqlFile path="scripts/ICM-097-car-loan.sql"/>
    </changeSet>

    <changeSet id="2018-02-07:add-car-dealer" author="ivar" context="moldova">
        <sqlFile path="scripts/ICM-097-car-dealer-loan.sql"/>
    </changeSet>

    <changeSet id="2018-02-09:suspension-sms-sent-field-to-installment" author="argo">

        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="installment_table" columnName="suspended_sms_sent_date"/></not>
        </preConditions>

        <addColumn tableName="installment_table">
            <column name="suspended_sms_sent_date" type="timestamp"/>
        </addColumn>

    </changeSet>

    <changeSet id="2018-02-09:maintenance-feature-toggle" author="argo">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('maintenance', 0, 'Enables MaintenanceController functionality', null, null,
            NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-02-13:refund-request" author="risto">

        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="loan_application" columnName="refund_request_saved"/></not>
        </preConditions>

        <addColumn tableName="loan_application">
            <column name="refund_request_saved" type="timestamp"/>
            <column name="refund_request_date" type="timestamp"/>
        </addColumn>

    </changeSet>

    <changeSet id="2018-02-27:add-extra-days-to-doc-template" author="ivar">
        <addColumn tableName="doc_template">
            <column name="extra_days" type="integer" defaultValue="0"></column>
        </addColumn>
    </changeSet>

    <changeSet id="2018-02-14:add restructure repayment" author="argo">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="repayments" columnName="restructured"/></not>
        </preConditions>
        <addColumn tableName="repayments">
            <column name="restructured" type="boolean default false"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-02-14:add restructured from to loan app" author="argo">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="loan_application" columnName="restructured_from"/></not>
        </preConditions>
        <addColumn tableName="loan_application">
            <column name="restructured_from" type="integer"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-02-19:add restructured row to installment" author="argo">
        <addColumn tableName="installment_table">
            <column name="restructured" type="decimal default 0"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-02-20:add-restructured-product" author="argo">
        <validCheckSum>7:6711c328d1f8f57bc4b25272e5b92fd1</validCheckSum>
        <validCheckSum>7:3a342ac85ab9462f4e6cee2ff637d025</validCheckSum>
        <sqlFile path="scripts/insert-restructured-loan-product.sql"/>
    </changeSet>

    <changeSet id="2018-02-20:product-fields-update" author="risto">
        <sql>
            ALTER TABLE loan_products DROP COLUMN IF EXISTS delay_interest;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS delay_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS max_delay_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS min_delay_debt;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS min_reminder_debt;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS min_termination_debt;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS internal_collection_days;
        </sql>
    </changeSet>

    <changeSet id="2018-02-20:scheduled-task-fix" author="risto">
        <sql>
            ALTER TABLE scheduled_task ALTER COLUMN description TYPE varchar(2000);
        </sql>
    </changeSet>

    <changeSet id="2018-02-22:add-car-loans" author="ivar" context="albania">
        <sqlFile path="scripts/ICA-071-car-loan.sql"/>
    </changeSet>

    <changeSet id="2018-02-22:views-functions-update" author="risto">
        <sqlFile path="scripts/22-02-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-02-22:add restructured_amount to loan application" author="argo">
        <addColumn tableName="loan_application">
            <column name="restructured_amount" type="decimal default 0"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-02-23:views-functions-update" author="argo">
        <sqlFile path="scripts/23-02-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-02-27:views-functions-update" author="argo">
        <sqlFile path="scripts/27-02-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-02-27:add-extra-days-to-doc-template" author="ivar">
        <addColumn tableName="doc_template">
            <column name="extra_days" type="integer" defaultValue="0"></column>
        </addColumn>
    </changeSet>

    <changeSet id="2018-03-02:views-functions-update" author="argo">
        <sqlFile path="scripts/02-03-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>


    <changeSet id="2018-03-29:remove-test-submitted-loans" author="oleg" context="macedonia">
        <sql>
            DELETE FROM submitted_loan a USING submitted_loan b WHERE a.id &lt; b.id and a.loan_app_id = b.loan_app_id;
        </sql>
    </changeSet>

    <changeSet id="2018-03-05:complete-sms-campaign-clients" author="oleg">
        <sql>
            UPDATE campaign_client cc
            SET completed_user = 'crm', assignee = 'crm', completed = cc.created
            FROM campaign_step cs
            WHERE cc.step_id = cs.id AND cs.type = 'sms' and cc.completed_user is null and completed is null and assignee is null;
        </sql>
    </changeSet>

    <changeSet id="2018-03-03:add-gender-to-campaign" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="campaign" columnName="gender"/>
            </not>
        </preConditions>

        <sql>
            ALTER TABLE campaign ADD COLUMN gender VARCHAR(6) NULL;
        </sql>
    </changeSet>

    <changeSet id="2018-03-04:add-rejection-reasons-to-campaign" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="campaign" columnName="rejection_reason"/>
            </not>
        </preConditions>

        <sql>
            ALTER TABLE campaign ADD COLUMN rejection_reason VARCHAR(500) NULL;
        </sql>
    </changeSet>

    <changeSet id="2018-03-05:views-functions-update" author="argo">
        <sqlFile path="scripts/05-03-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-03-09:views-functions-update" author="argo">
        <sqlFile path="scripts/09-03-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-03-12:views-functions-update" author="argo">
        <sqlFile path="scripts/12-03-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-03-15:views-functions-update" author="argo">
        <sqlFile path="scripts/15-03-2018-views-function-update.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-03-22:additional-column-to-defaulted-loans-report" author="argo">
        <sqlFile path="scripts/22-03-2018-additional-column-to-defaulted-loans-report.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-03-22:insert-FFF-kosovo" author="ivar" context="kosovo">
        <sqlFile path="scripts/insert-FFF-kosovo.sql"/>
    </changeSet>

    <changeSet id="2018-04-05:remove-internal-collection-date" author="argo">
        <sqlFile path="scripts/05-04-2018-remove-internal-collection-date.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-04-27:add-alternate-days-to-overdue-actions" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="overdue_action" columnName="alternate_delay_days"/>
            </not>
        </preConditions>

        <addColumn tableName="overdue_action">
            <column name="alternate_delay_days" type="int"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-04-04:add-loan-purpose-as-classifier-in-crm" author="reimo">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="loan_application" columnName="other_purpose"/></not>
        </preConditions>
        <sqlFile path="scripts/ALL-15-Add_Loan_purpose_as_classifier_in_CRM.sql"/>
    </changeSet>

    <changeSet id="2018-04-20:sync-indexes" author="reimo" context="moldova">
        <sqlFile path="scripts/ALL-106-compare_all_databases_to_list_indexes.sql"/>
    </changeSet>

    <changeSet id="2018-04-24:country-config-table" author="argo">

        <createTable tableName="country_configuration">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="property" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="property_group" type="varchar(100)">
                <constraints nullable="true"/>
            </column>
            <column name="boolean_value" type="boolean" defaultValueBoolean="false"/>
        </createTable>

    </changeSet>

    <changeSet id="2018-06-18:add-mintos-configuration-for-kosovo" author="argo" context="kosovo">
        <sqlFile path="scripts/kosovo-mintos-config.sql"/>
    </changeSet>

    <changeSet id="2018-06-18:add-mintos-configuration-for-macedonia" author="argo" context="macedonia">
        <sqlFile path="scripts/macedonia-mintos-config.sql"/>
    </changeSet>

    <changeSet id="2018-06-18:add-mintos-apr-country-configuration" author="argo">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('mintos', 'apr_calculation_data.net_issued_amount', false);
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('mintos', 'apr_calculation_data.actual_payment_schedule', false);
        </sql>
    </changeSet>

    <changeSet id="2018-04-20:sync-indexes" author="reimo" context="macedonia">
        <sqlFile path="scripts/ALL-106-compare_all_databases_to_list_indexes.sql"/>
    </changeSet>

    <changeSet id="2018-04-20:sync-indexes" author="reimo" context="kosovo">
        <sqlFile path="scripts/ALL-106-compare_all_databases_to_list_indexes.sql"/>
    </changeSet>

    <changeSet id="2018-04-20" author="ivar" context="moldova">
        <sql><![CDATA[

            UPDATE overdue_action SET doc_template_id = 127, doc_template_secondary_id = 128 WHERE id = 49;
            UPDATE doc_template SET content = '<p>Va reamintim ca ziua de plata pentru imprumutul [ref_nr] este [current_date], suma spre plata [amount] lei. Daca ati achitat deja, ignorati acest mesaj</p>' WHERE id = 117;
            UPDATE doc_template SET content = '<p>Napominaem vam chto [current_date] – deni oplaty po zaimu [ref_nr], summa k oplate [amount] lei. Esli vy uje vnesli platej, ignoriruite dannoe soobshenie </p>' WHERE id = 118;
            UPDATE doc_template SET content = '<p>Ati primit 200 lei penalitate pentru intarziere in achitarea creditului [ref_nr]. Total spre plata [amount] lei, suma creste zilnic! Achitati urgent! 022801500</p>' WHERE id = 119;
            UPDATE doc_template SET content = '<p>Vy poluchili 200 lei shtrafa za zaderjku po oplate zaima [ref_nr]. Polnaia summa k oplate [amount] lei; shtraf rastet ejednevno! Srochno vnesite platej! 022801500</p>' WHERE id = 120;
            UPDATE doc_template SET content = '<p>Ati primit 200 lei penalitate pentru intarziere in achitarea creditului [ref_nr]. Total spre plata [amount] lei, suma creste zilnic! Achitati urgent! 022801500</p>' WHERE id = 121;
            UPDATE doc_template SET content = '<p>Vy poluchili 200 lei shtrafa za zaderjku po oplate zaima [ref_nr]. Polnaia summa k oplate [amount] lei; shtraf rastet ejednevno! Srochno vnesite platej! 022801500</p>' WHERE id = 122;
            UPDATE doc_template SET content = '<p>Aveti [days_late] zile intirziere la achitarea imprumutului [ref_nr]! Achitati urgent [amount] lei pentru a evita intreruperea contractului! Info 022801500</p>' WHERE id = 123;
            UPDATE doc_template SET content = '<p>Vy zaderjali na [days_late] dnia platej po zaimu [ref_nr]! Srochno oplatite [amount] lei, inache vash dogovor budet rastorgnut! Info 022801500</p>' WHERE id = 124;
            UPDATE doc_template SET content = '<p>In scurt contractul dvs de imprumut [ref_nr] va fi intrerupt si veti primi 30% penalitate de la suma datoriei. Datoria dvs este [amount] lei! Info 022801500</p>' WHERE id = 127;
            UPDATE doc_template SET content = '<p>Va skorom vremeni vash dogovor zaima 123465 budet rastorgnut, vy poluchite shtraf 30% ot dolga. Vash dolg [amount] lei! Info 022801500</p>' WHERE id = 128;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-04-20:claim-totals-bug" author="oliver">
        <validCheckSum>any</validCheckSum>
        <comment>ALL-117</comment>
        <sqlFile path="functions/get_claim_totals.sql" relativeToChangelogFile="true" splitStatements="false" encoding="UTF-8" />
    </changeSet>

    <changeSet id="2018-04-20:albania-mintos-configuration" author="argo" context="albania">
        <sqlFile path="scripts/albania-mintos-config.sql"/>
    </changeSet>

    <changeSet id="2018-04-20:moldova-mintos-configuration" author="argo" context="moldova">
        <sqlFile path="scripts/moldova-mintos-config.sql"/>
    </changeSet>

    <changeSet id="2018-04-24:add-missing-penalty-amount-col" author="argo">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="mintos_repayment" columnName="penalty_amount_eur"/></not>
        </preConditions>
        <addColumn tableName="mintos_repayment">
            <column name="penalty_amount_eur" type="decimal(20, 16)"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-04-24:increase_decimal_places_for_mintos_repayment" author="argo">
        <modifyDataType columnName="interest_amount_eur"
                        newDataType="decimal(20, 16)"
                        tableName="mintos_repayment"/>
        <modifyDataType columnName="repayment_amount_eur"
                        newDataType="decimal(20, 16)"
                        tableName="mintos_repayment"/>
        <modifyDataType columnName="penalty_amount_eur"
                        newDataType="decimal(20, 16)"
                        tableName="mintos_repayment"/>
        <modifyDataType columnName="remaining_principal_eur"
                        newDataType="decimal(20, 16)"
                        tableName="mintos_repayment"/>

    </changeSet>

    <changeSet id="2018-04-26:doc_template_to_loan_product_fix" author="ivar" context="moldova">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from doc_template where id = 123</sqlCheck>
        </preConditions>
        <sql>
            insert into doc_template_loan_product(loan_product_id,template_id) values(24,123),(24,124);
        </sql>
    </changeSet>

    <changeSet id="2018-05-03:infodebitChecksToggle" author="ivar">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('infodebitChecks', 1, 'Toggle infodebit checking', null, null,
            NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-05-04:renameInfodebitToggle" author="ivar">
        <sql>
            update ff4j_features set description = 'Make infodebit checks' where feat_uid= 'infodebitChecks';
        </sql>
    </changeSet>

    <changeSet id="2018-05-08:fix-amounts-for-products" author="ivar">
        <sqlFile path="scripts/fix-amounts-for-products.sql"/>
    </changeSet>

    <changeSet id="2018-06-05:fix-for-fidel-xl-chenanigans" author="ivar" context="moldova">
        <sqlFile path="scripts/insert-xl-extra-moldova.sql"/>
    </changeSet>

    <changeSet id="2018-05-16:product-group-limits" author="ivar">
        <sqlFile path="scripts/product-group-limits.sql"/>
    </changeSet>

    <changeSet id="2018-05-15:pay_out_too_old_data" author="oliver">
        <comment>ALL-117</comment>
        <sql>
            update loan_application set pay_out_to = 'bank' where dealer_id is not null and pay_out_to is null;
        </sql>
    </changeSet>

    <changeSet id="2018-05-15:addNoFrameAgreementRejection" author="oleg">
        <sql>
            INSERT INTO classifier (type, key, value) VALUES ('rejectionReasons', 'no_fa', 'No FA');
        </sql>
    </changeSet>

    <changeSet id="2018-05-28:fix-claim-total-for-restructured" author="argo">
        <sqlFile path="scripts/fix_claim_totals_for_restructure.sql" relativeToChangelogFile="true" splitStatements="false"/>
    </changeSet>

    <changeSet id="set-alternate-delay-days-for-active-overdue-action-where-collection-days-gt" author="argo">
        <sql>
            update overdue_action set
            alternate_delay_days = (select overdue_days + 10 from overdue_action
            where overdue_settings_id = (select id from overdue_process_settings ORDER BY valid_from desc limit 1)
            and reminder_type = 30)
            where overdue_settings_id = (select id from overdue_process_settings ORDER BY valid_from desc limit 1)
            and reminder_type = 36
            and overdue_days > (select overdue_days + 10 from overdue_action
            where overdue_settings_id = (select id from overdue_process_settings ORDER BY valid_from desc limit 1)
            and reminder_type = 30)
        </sql>
    </changeSet>

    <changeSet id="2018-06-01:update-sms-template-reminder-fees" author="argo" context="moldova">
        <sql>
            <![CDATA[
            update doc_template set
            content = '<p>Ati primit [second_reminder_letter_fee] lei penalitate pentru intarziere in achitarea creditului [ref_nr]. Total spre plata [amount] lei, suma creste zilnic! Achitati urgent! 022801500</p>'
            where id = 119;

            update doc_template set
            content = '<p>Vy poluchili [second_reminder_letter_fee] lei shtrafa za zaderjku po oplate zaima [ref_nr]. Polnaia summa k oplate [amount] lei; shtraf rastet ejednevno! Srochno vnesite platej! 022801500</p>'
            where id = 120;

            update doc_template set
            content = '<p>Ati primit [termination_alert_letter_fee] lei penalitate pentru intarziere in achitarea creditului [ref_nr]. Total spre plata [amount] lei, suma creste zilnic! Achitati urgent! 022801500</p>'
            where id = 121;

            update doc_template set
            content = '<p>Vy poluchili&nbsp;[termination_alert_letter_fee] lei shtrafa za zaderjku po oplate zaima [ref_nr]. Polnaia summa k oplate [amount] lei; shtraf rastet ejednevno! Srochno vnesite platej! 022801500</p>'
            where id = 122;

            update doc_template set
            content = '<p>In scurt contractul dvs de imprumut [ref_nr] va fi intrerupt si veti primi [termination_notice_fee]% penalitate de la suma datoriei. Datoria dvs este [amount] lei! Info 022801500</p>'
            where id = 127;

            update doc_template set
            content = '<p>Va skorom vremeni vash dogovor zaima [ref_nr] budet rastorgnut, vy poluchite shtraf [termination_notice_fee]% ot dolga. Vash dolg [amount] lei! Info 022801500</p>'
            where id = 128;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-06-05:update-sms-template-reminder-fees" author="argo" context="albania">
        <sql>
            <![CDATA[
            update doc_template set
            content = '<p>Se shpejti kontrata juaj [ref_nr] me IuteCredit mbyllet dhe aplikohet nje penalitet prej [termination_notice_fee]% te shumes se papaguar.Paguani sa me shpejt ose telefononi 044505060</p>'
            where id = 22;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-06-05:update-sms-template-reminder-fees" author="argo" context="kosovo">
        <sql>
            <![CDATA[
            update doc_template set
            content = '<p>Ju keni marre penalitet prej [termination_notice_fee]EUR per kredine [ref_nr] ne IuteCredit. Detyrimi total eshte [total_debt]EUR. Per info kontaktoni 038406080</p>'
            where id = 22;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-06-20:comfort-configuration" author="oleg">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('user', 'enableSoftReminderCall', false);
        </sql>
    </changeSet>
    <changeSet id="2018-06-06:comfort-configuration" author="oleg">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('comfort', 'comparePreviousPhoneNumber', false);
        </sql>
    </changeSet>

    <changeSet id="2018-06-11:add_create_col_to_mintos_portfolio" author="argo">

        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="mintos_portfolio" columnName="created"/>
            </not>
        </preConditions>

        <addColumn tableName="mintos_portfolio">
            <column name="created" type="timestamp" defaultValueComputed="now()"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-06-11:correct_create_date_for_portfolios" author="argo" context="albania">
        <sql>
            UPDATE mintos_portfolio set created = '2017-06-06 11:46:03.000000' where id = 1;
            UPDATE mintos_portfolio set created = '2017-06-08 21:34:36.000000' where id = 2;
            UPDATE mintos_portfolio set created = '2017-06-13 19:00:00.000000' where id = 3;
            UPDATE mintos_portfolio set created = '2017-06-21 19:00:00.000000' where id = 4;
            UPDATE mintos_portfolio set created = '2017-08-24 19:00:00.000000' where id = 5;
            UPDATE mintos_portfolio set created = '2017-09-18 19:00:00.000000' where id = 6;
            UPDATE mintos_portfolio set created = '2017-09-29 19:00:00.000000' where id = 7;
            UPDATE mintos_portfolio set created = '2017-12-05 19:00:00.000000' where id = 8;
            UPDATE mintos_portfolio set created = '2017-12-21 19:00:00.000000' where id = 9;
            UPDATE mintos_portfolio set created = '2018-01-04 19:00:00.000000' where id = 10;
            UPDATE mintos_portfolio set created = '2018-01-05 19:00:00.000000' where id = 11;
            UPDATE mintos_portfolio set created = '2018-01-08 19:00:00.000000' where id = 12;
            UPDATE mintos_portfolio set created = '2018-01-09 19:00:00.000000' where id = 13;
            UPDATE mintos_portfolio set created = '2018-01-26 19:00:00.000000' where id = 14;
            UPDATE mintos_portfolio set created = '2018-01-26 19:00:00.000000' where id = 15;
            UPDATE mintos_portfolio set created = '2018-01-26 19:00:00.000000' where id = 16;
            UPDATE mintos_portfolio set created = '2018-03-19 19:27:47.000000' where id = 17;
            UPDATE mintos_portfolio set created = '2018-03-19 19:34:53.000000' where id = 18;
            UPDATE mintos_portfolio set created = '2018-03-19 19:40:35.000000' where id = 19;
            UPDATE mintos_portfolio set created = '2018-03-19 19:45:15.000000' where id = 20;
            UPDATE mintos_portfolio set created = '2018-04-25 11:02:16.000000' where id = 21;
            UPDATE mintos_portfolio set created = '2018-04-25 11:12:03.000000' where id = 22;
            UPDATE mintos_portfolio set created = '2018-05-02 16:30:25.000000' where id = 23;
            UPDATE mintos_portfolio set created = '2018-05-04 11:51:43.000000' where id = 24;
            UPDATE mintos_portfolio set created = '2018-05-10 11:20:37.000000' where id = 25;
            UPDATE mintos_portfolio set created = '2018-05-22 10:42:17.000000' where id = 26;
            UPDATE mintos_portfolio set created = '2018-06-01 10:37:02.000000' where id = 27;
            UPDATE mintos_portfolio set created = '2018-06-07 19:12:20.000000' where id = 28;
        </sql>
    </changeSet>

    <changeSet id="2018-06-11:correct_create_date_for_portfolios" author="argo" context="moldova">
        <sql>
            UPDATE mintos_portfolio set created = '2018-04-03 13:48:47.271000' where id = 1;
            UPDATE mintos_portfolio set created = '2018-05-01 19:00:00.023000' where id = 3;
            UPDATE mintos_portfolio set created = '2018-05-07 07:40:55.000000' where id = 4;
            UPDATE mintos_portfolio set created = '2018-05-10 16:51:57.000000' where id = 5;
            UPDATE mintos_portfolio set created = '2018-05-16 17:49:17.000000' where id = 6;
        </sql>
    </changeSet>

    <changeSet id="2018-06-21:fix-get-indebtcollection-loanapps" author="argo">
        <sqlFile path="scripts/fix-get-indeptcollection-loanapps.sql" relativeToChangelogFile="true" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-06-18:insert-fff-dealer-moldova" author="ivar" context="moldova">
        <sqlFile path="scripts/insert-FFF-dealer-moldova.sql"/>
    </changeSet>

    <changeSet id="2018-07-02-crm-109" author="Oliver Kell" context="moldova">
        <comment>CRM-109 - Basic Special in Moldova</comment>
        <insert tableName="loan_products">
            <column name="id" value="27" />
            <column name="admission_fee_perc" value="15" />
            <column name="max_interest" value="12" />
            <column name="max_loan_period" value="12" />
            <column name="max_principal" value="15000" />
            <column name="min_interest" value="5" />
            <column name="min_loan_period" value="2" />
            <column name="min_principal" value="500" />
            <column name="name" value="Basic Special" />
            <column name="type" value="regular" />
            <column name="suspension_fee" value="65" />
            <column name="apr_threshold" value="116" />
            <column name="req_id_copy" value="true" />
            <column name="req_salary_cert" value="false" />
            <column name="min_apr" value="24" />
            <column name="max_apr" value="45" />
            <column name="pm_default" value="false" />
            <column name="salary_ratio_regular" value="60" />
            <column name="salary_ratio_second_active" value="60" />
            <column name="salary_ratio_unofficial" value="60" />
            <column name="guarantee_fee_perc" value="0.55" />
            <column name="guarantee_max_period" value="6" />
            <column name="guarantee_product" value="true" />
            <column name="paid_inst_records_threshold" value="2" />
            <column name="turnover_threshold" value="0" />
            <column name="official_paid_inst_records_threshold" value="1" />
            <column name="official_turnover_threshold" value="0" />
            <column name="max_suspended_days" value="17" />
            <column name="official_paid_inst_records_threshold_office" value="3" />
            <column name="official_turnover_threshold_office" value="0" />
            <column name="paid_inst_records_threshold_office" value="3" />
            <column name="turnover_threshold_office" value="0" />
            <column name="enabled" value="false" />
            <column name="car_loan" value="false" />
            <column name="max_car_value_perc" value="0" />
            <column name="apr_threshold_evening" value="116" />
            <column name="apr_threshold_evening_guarantee" value="116" />
            <column name="closed_loans_archival_threshold_years" value="3" />
            <column name="defaulted_loans_archival_threshold_years" value="5" />
            <column name="dept_collection_days" value="70" />
            <column name="first_call_days" value="5" />
            <column name="first_letter_days" value="10" />
            <column name="first_letter_fee" value="200" />
            <column name="first_sms_days" value="8" />
            <column name="first_sms_text" value="Field not used" />
            <column name="fourth_call_days" value="33" />
            <column name="payment_sms_days" value="2" />
            <column name="second_call_days" value="13" />
            <column name="second_letter_days" value="20" />
            <column name="second_letter_fee" value="200" />
            <column name="second_sms_days" value="18" />
            <column name="second_sms_text" value="Field not used" />
            <column name="term_alert_letter_days" value="30" />
            <column name="term_alert_letter_fee" value="200" />
            <column name="term_letter_days" value="50" />
            <column name="term_letter_days_max" value="50" />
            <column name="term_letter_fee_perc" value="30" />
            <column name="term_sms_days" value="38" />
            <column name="third_call_days" value="22" />
            <column name="third_sms_days" value="27" />
            <column name="sms_sign_limit" value="1000" />
            <column name="requires_data_verification" value="false" />
            <column name="requesting_fix_amount_by_sms_mandatory" value="false" />
        </insert>

        <insert tableName="loan_product_settings">
            <column name="checking_duration" value="25" />
            <column name="scoring_duration" value="5" />
            <column name="notify_client_duration" value="15" />
            <column name="pay_out_duration" value="120" />
            <column name="upload_agreement_duration" value="15" />
            <column name="vip" value="false" />
            <column name="loan_product_id" value="27" />
            <column name="allow_cash_release_duration" value="15" />
            <column name="type" value="general" />
            <column name="check_score_duration" value="27" />
            <column name="bonus_task_duration_until_paid_out" value="30" />
        </insert>
    </changeSet>

    <changeSet id="2018-06-27-crm-88" author="Oliver Kell" context="albania">
        <comment>CRM-88 - FFF dealer in Albania</comment>
        <insert tableName="loan_products">
            <column name="id" value="105" />
            <column name="admission_fee_perc" value="0" />
            <column name="max_apr" value="0" />
            <column name="max_interest" value="0" />
            <column name="max_loan_period" value="1" />
            <column name="max_principal" value="20000" />
            <column name="min_apr" value="0" />
            <column name="min_interest" value="0" />
            <column name="min_loan_period" value="1" />
            <column name="min_principal" value="5000" />
            <column name="name" value="FFF Dealer" />
            <column name="pm_default" value="false" />
            <column name="req_id_copy" value="true" />
            <column name="req_salary_cert" value="false" />
            <column name="suspension_fee" value="500" />
            <column name="type" value="dealer" />
            <column name="salary_ratio_regular" value="60" />
            <column name="guarantee_max_period" value="999" />
            <column name="guarantee_product" value="false" />
            <column name="paid_inst_records_threshold" value="4" />
            <column name="turnover_threshold" value="0" />
            <column name="max_suspended_days" value="17" />
            <column name="official_paid_inst_records_threshold" value="4" />
            <column name="official_turnover_threshold" value="3" />
            <column name="salary_cert_limit" value="50000.01" />
            <column name="official_paid_inst_records_threshold_office" value="4" />
            <column name="official_turnover_threshold_office" value="0" />
            <column name="paid_inst_records_threshold_office" value="4" />
            <column name="turnover_threshold_office" value="0" />
            <column name="enabled" value="false" />
            <column name="car_loan" value="false" />
            <column name="max_car_value_perc" value="0" />
            <column name="requires_data_verification" value="false" />
            <column name="requesting_fix_amount_by_sms_mandatory" value="false" />
        </insert>

        <insert tableName="loan_product_settings">
            <column name="allow_cash_release_duration" value="30" />
            <column name="checking_duration" value="45" />
            <column name="check_score_duration" value="30" />
            <column name="scoring_duration" value="15" />
            <column name="notify_client_duration" value="15" />
            <column name="pay_out_duration" value="60" />
            <column name="type" value="general" />
            <column name="upload_agreement_duration" value="15" />
            <column name="vip" value="false" />
            <column name="loan_product_id" value="105" />
            <column name="bonus_task_duration_until_paid_out" value="30" />
        </insert>
    </changeSet>

    <changeSet id="2018-03-05:drop-unused-columns" author="argo">
        <sql>
            ALTER TABLE loan_products DROP COLUMN IF EXISTS closed_loans_archival_threshold_years;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS defaulted_loans_archival_threshold_years;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS dept_collection_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS first_call_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS first_letter_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS first_letter_fee;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS first_sms_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS first_sms_text;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS fourth_call_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS invitation_text;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS payment_sms_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS preclaim_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS second_call_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS second_letter_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS second_letter_fee;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS second_sms_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS second_sms_text;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS term_alert_letter_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS term_alert_letter_fee;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS term_letter_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS term_letter_days_max;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS term_letter_fee_perc;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS term_sms_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS thankyou_notice;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS third_call_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS third_letter_days;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS third_letter_fee;
            ALTER TABLE loan_products DROP COLUMN IF EXISTS third_sms_days;
        </sql>
    </changeSet>

    <changeSet id="2018-06-29-crm-88" author="Oliver Kell" context="albania">
        <comment>CRM-88 - FFF dealer in Albania</comment>
        <update tableName="loan_products">
            <column name="salary_ratio_second_active" value="0" />
            <column name="salary_ratio_unofficial" value="0" />
            <where>id = 105</where>
        </update>
    </changeSet>

    <changeSet id="2018-06-29:add-column-on-hold-to-loan-task-table" author="reimo">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="loan_task" columnName="on_hold"/></not>
        </preConditions>
        <sqlFile path="scripts/ALL-183-postpone_option_for_check_documents_task_on_print_center.sql"/>
    </changeSet>


    <changeSet id="2018-06-25:add-default-values-to-new-bonus-sign-operations" author="argo">
        <sql>
            INSERT INTO bonus_settings_operation (key, operation, source, type, unit, value)
            values ('sign_app_2_dealer', 'addSignedAgreement', 'act_hi_taskinst', 'basic', 'mdl', (SELECT value from bonus_settings_operation where key='sign_app_2'));

            INSERT INTO bonus_settings_operation (key, operation, source, type, unit, value)
            values ('sign_app_2_car', 'addSignedAgreement', 'act_hi_taskinst', 'basic', 'mdl', (SELECT value from bonus_settings_operation where key='sign_app_2'));

            INSERT INTO bonus_settings_operation (key, operation, source, type, unit, value)
            values ('sign_app_2_branded_card', 'addSignedAgreement', 'act_hi_taskinst', 'basic', 'mdl', (SELECT value from bonus_settings_operation where key='sign_app_2'));
        </sql>
    </changeSet>

    <changeSet id="2018-07-04:new-kosovo-overdue-settings" author="risto" context="kosovo">
        <sqlFile path="scripts/CRM-127-new-kosovo-overdue-settings.sql"/>
    </changeSet>

    <changeSet id="2018-04-19:rename_post_office_table" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="partner_office"/>
            </not>
        </preConditions>

        <renameTable oldTableName="post_office" newTableName="partner_office"/>
    </changeSet>

    <changeSet id="2018-04-19:add_type_to_post_office" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="partner_office" columnName="office_type"/>
            </not>
        </preConditions>

        <sql>
            ALTER TABLE partner_office ADD COLUMN office_type VARCHAR(200);
            UPDATE partner_office set office_type='posta';
            alter table partner_office alter COLUMN office_type set not null;

            ALTER TABLE partner_office RENAME CONSTRAINT post_office_pkey TO partner_office_pkey;

            alter index post_office_email_key rename to partner_office_email_key;

            alter table loan_application rename column post_office_id to partner_office_id;
            alter table loan_application rename constraint fk_post_office_loan to fk_partner_office_loan;

            alter table submitted_loan rename column postofficeid to partner_office_id;
        </sql>
    </changeSet>

    <changeSet id="2018-04-19:rename-post-office-workdays-to-partner-office" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="partner_office_workday"/>
            </not>
        </preConditions>

        <sql>
            alter table post_office_workday rename constraint post_office_workday_pkey to partner_office_workday_pkey;
            alter table post_office_workday rename constraint fk_post_office_workday to fk_partner_office_workday;
            alter table post_office_workday rename to partner_office_workday;
            alter table partner_office_workday rename column post_office_id to partner_office_id;
        </sql>
    </changeSet>

    <changeSet id="rename-posta-deposit-to-partner-deposit" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="partner_deposit"/>
            </not>
        </preConditions>

        <sql>
            alter table posta_deposit rename to partner_deposit;
        </sql>
        <addColumn tableName="partner_deposit">
            <column name="partner_type" type="varchar(100)" defaultValue="posta"/>
        </addColumn>
    </changeSet>

    <changeSet id="add-partner-type-to-agreement-recipient" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="agreement_recipient" columnName="partner_type"/>
            </not>
        </preConditions>

        <addColumn tableName="agreement_recipient">
            <column name="partner_type" type="varchar(100)" defaultValue="posta"/>
        </addColumn>

        <sql>
            UPDATE agreement_recipient set partner_type='posta';
        </sql>
    </changeSet>

    <changeSet id="change-source-for-deposits-to-partner-instead-of-posta" author="argo">
        <sql>
            UPDATE partner_deposit set source='partner' where source='posta';
        </sql>
    </changeSet>

    <changeSet id="add-partner-country-configuration" author="argo" context="moldova">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'posta', true);
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'western_union', false);
        </sql>
    </changeSet>

    <changeSet id="add-partner-country-configuration" author="argo" context="albania">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'posta', true);
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'western_union', true);
        </sql>
    </changeSet>

    <changeSet id="add-partner-country-configuration" author="argo" context="macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'posta', false);
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'western_union', false);
        </sql>
    </changeSet>

    <changeSet id="add-partner-country-configuration" author="argo" context="kosovo">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'posta', true);
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('partner', 'western_union', false);
        </sql>
    </changeSet>

    <changeSet id="rename-submit-post-office-to-submit-partner-office" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="loan_application" columnName="submit_partner_office"/>
            </not>
        </preConditions>

        <sql>
            alter table loan_application rename column submit_post_office to submit_partner_office;
        </sql>
    </changeSet>

    <changeSet id="2018-06-20:rename-posta-to-partner-in-settings" author="argo">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="settings" columnName="partner_mail_request_duration"/>
            </not>
        </preConditions>

        <sql>
            alter table settings rename column posta_mail_request_duration to partner_mail_request_duration;
            alter table settings rename column posta_balance_limit to partner_balance_limit;
        </sql>
    </changeSet>

    <changeSet id="2018-07-09:change-union_net-to-western_union" author="argo" context="albania">
        <sql>
            update repayments set bank = 'western_union', user_name = 'western_union' where bank='union_net';
            update payment set bank = 'western_union', user_name = 'western_union' where bank='union_net';
        </sql>
    </changeSet>
    <changeSet id="2018-07-09-crm-38" author="Oliver Kell" context="macedonia">
        <comment>CRM-38 - Car loan (new owner) in Macedonia</comment>
        <insert tableName="loan_products">
            <column name="id" value="25" />
            <column name="admission_fee_perc" value="70" />
            <column name="max_apr" value="131" />
            <column name="max_interest" value="10" />
            <column name="max_loan_period" value="48" />
            <column name="max_principal" value="300000" />
            <column name="min_apr" value="40.79" />
            <column name="min_interest" value="10" />
            <column name="min_loan_period" value="1" />
            <column name="min_principal" value="30000" />
            <column name="name" value="Car Loan Dealer (New Owner)" />
            <column name="pm_default" value="false" />
            <column name="req_id_copy" value="true" />
            <column name="req_salary_cert" value="false" />
            <column name="type" value="dealer" />
            <column name="salary_ratio_regular" value="50" />
            <column name="salary_ratio_second_active" value="60" />
            <column name="guarantee_product" value="false" />
            <column name="paid_inst_records_threshold" value="6" />
            <column name="max_suspended_days" value="17" />
            <column name="official_paid_inst_records_threshold" value="3" />
            <column name="official_paid_inst_records_threshold_office" value="6" />
            <column name="paid_inst_records_threshold_office" value="6" />
            <column name="enabled" value="false" />
            <column name="car_loan" value="true" />
            <column name="max_car_value_perc" value="80" />
            <column name="requires_data_verification" value="false" />
            <column name="requesting_fix_amount_by_sms_mandatory" value="false" />
        </insert>

        <insert tableName="loan_product_settings">
            <column name="allow_cash_release_duration" value="30" />
            <column name="checking_duration" value="45" />
            <column name="check_score_duration" value="30" />
            <column name="scoring_duration" value="15" />
            <column name="notify_client_duration" value="15" />
            <column name="pay_out_duration" value="60" />
            <column name="type" value="general" />
            <column name="upload_agreement_duration" value="15" />
            <column name="vip" value="false" />
            <column name="loan_product_id" value="25" />
            <column name="bonus_task_duration_until_paid_out" value="30" />
        </insert>
    </changeSet>

    <changeSet id="2018-07-12-crm-38" author="Oliver Kell" context="macedonia">
        <comment>CRM-38 - Car loan (new owner) in Macedonia</comment>
        <update tableName="loan_products">
            <column name="salary_ratio_unofficial" value="0" />
            <where>id = 25</where>
        </update>
    </changeSet>
    <changeSet id="2018-07-04:add-mintos-apr-first-agreement-date" author="oleg">
        <sql>
            INSERT INTO country_configuration (property_group, property, boolean_value) VALUES ('mintos', 'apr_calculation_data.first_agreement_date', false);
        </sql>
    </changeSet>

    <changeSet id="2018-07-09:mintos-apr-settings" author="oleg" context="albania,moldova">
        <sql>
            UPDATE country_configuration SET boolean_value = true where property_group = 'mintos' and property like 'apr_calculation_data.%';
        </sql>
    </changeSet>

    <changeSet id="2018-07-16:crm-139-new-location-table" author="oliver">
        <comment>CRM-139 - Moldova cities normalization</comment>
        <createTable tableName="location">
            <column autoIncrement="true" name="id" type="serial">
                <constraints primaryKey="true"/>
            </column>
            <column name="type" type="VARCHAR(50)">
                <constraints nullable="false"/>
            </column>
            <column name="value" type="VARCHAR(500)">
                <constraints nullable="false"/>
            </column>
            <column name="active" type="boolean" defaultValue="true">
                <constraints nullable="false"/>
            </column>
            <column name="created_at" type="timestamp without timezone">
                <constraints nullable="false"/>
            </column>
            <column name="updated_at" type="timestamp without timezone">
                <constraints nullable="false"/>
            </column>
        </createTable>
        <addUniqueConstraint tableName="location" columnNames="type, value"/>
    </changeSet>

    <changeSet id="2018-07-16:crm-139-add-cities" author="oliver" context="moldova">
        <comment>CRM-139 - Moldova cities normalization</comment>
        <sqlFile path="scripts/moldova-cities-normalization.sql" relativeToChangelogFile="true" splitStatements="false" encoding="UTF-8" />
    </changeSet>

    <changeSet id="2018-07-12:double-paidout-entries" author="argo">
        <validCheckSum>any</validCheckSum>
        <comment>CRM-151</comment>
        <sqlFile path="views/v_paidout.sql" relativeToChangelogFile="true" splitStatements="false" />
    </changeSet>


    <changeSet id="2018-07-12:web-integration-all" author="reimo">
        <sql>
            INSERT INTO "country_configuration" ("property", "property_group", "boolean_value") VALUES ('response_without_commas', 'web-integration', FALSE);
        </sql>
    </changeSet>

    <changeSet id="2018-07-12:web-integration-moldova" author="reimo" context="moldova">
        <sql>
            UPDATE "country_configuration" SET "boolean_value" = TRUE WHERE "property" = 'response_without_commas' AND "property_group" = 'web-integration';
        </sql>
    </changeSet>

    <changeSet id="2018-07-17:add-delay-interest-source" author="argo">
        <addColumn tableName="overdue_process_settings">
            <column name="delay_interest_source" type="varchar" defaultValue="PRIMARY"></column>
        </addColumn>
    </changeSet>

    <changeSet id="2018-07-18:add-new-overdue-settings" author="argo" context="kosovo">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="overdue_process_settings" columnName="delay_interest_source"/>
        </preConditions>

        <sql>
            BEGIN;
            -- protect against concurrent inserts while you update the counter
            LOCK TABLE overdue_action IN EXCLUSIVE MODE;
            -- Update the sequence
            SELECT setval('overdue_action_id_seq', COALESCE((SELECT MAX(id)+1 FROM overdue_action), 1), false);
            COMMIT;
        </sql>
        <sqlFile path="scripts/CRM-172-delay-interest-calculation-on-principal.sql" />
    </changeSet>

    <changeSet id="2018-07-20-crm-195" author="Oliver Kell">
        <comment>Add new loan purpose</comment>
        <insert tableName="classifier">
            <column name="key" value="online_shopping"/>
            <column name="type" value="loan_purpose"/>
            <column name="value" value="Online shopping"/>
        </insert>
    </changeSet>

    <changeSet id="2018-07-18:DPI-report-NPE-fix" author="argo">
        <validCheckSum>any</validCheckSum>
        <comment>CRM-173</comment>
        <sqlFile path="functions/get_defaulted_loanapps_base.sql" relativeToChangelogFile="true" splitStatements="false" />
        <sqlFile path="functions/get_dpi_base_defaultgroup.sql" relativeToChangelogFile="true" splitStatements="false" />
        <sqlFile path="functions/get_dpi_base_writtenoff.sql" relativeToChangelogFile="true" splitStatements="false" />
    </changeSet>

    <changeSet id="2018-07-25:add-car-loans" author="oliver" context="kosovo">
        <sqlFile path="scripts/CRM-212-car-loan.sql"/>
    </changeSet>

    <changeSet id="2018-07-25:add-new-overdue-settings-other-countries" author="argo">
        <sql>
            BEGIN;
            -- protect against concurrent inserts while you update the counter
            LOCK TABLE overdue_action IN EXCLUSIVE MODE;
            -- Update the sequence
            SELECT setval('overdue_action_id_seq', COALESCE((SELECT MAX(id)+1 FROM overdue_action), 1), false);
            COMMIT;
        </sql>
    </changeSet>

    <changeSet id="2018-07-25:overdue-update" author="ivar" context="macedonia">
        <sqlFile path="scripts/ICA-211-overdue-settings.sql" />
    </changeSet>

    <changeSet id="2018-07-12-crm-205" author="Oliver Kell" context="macedonia">
        <comment>CRM-205 - Fidel XL in Macedonia</comment>
        <update tableName="loan_products">
            <column name="min_interest" value="0" />
            <column name="max_interest" value="5" />
            <column name="min_apr" value="62.01" />
            <column name="max_apr" value="137.55" />
            <column name="min_principal" value="3000" />
            <column name="max_principal" value="100000" />
            <column name="min_loan_period" value="1" />
            <column name="max_loan_period" value="18" />
            <column name="admission_fee_perc" value="50" />
            <column name="salary_ratio_regular" value="50" />
            <column name="salary_ratio_second_active" value="55" />
            <column name="salary_ratio_unofficial" value="50" />
            <where>id = 9</where>
        </update>
    </changeSet>

    <changeSet id="2018-07-26-crm-205" author="Oliver Kell" context="macedonia">
        <comment>CRM-205 - Fidel XL in Macedonia</comment>
        <update tableName="loan_products">
            <column name="official_paid_inst_records_threshold_office" value="4" />
            <column name="paid_inst_records_threshold_office" value="4" />
            <column name="official_paid_inst_records_threshold" value="4" />
            <column name="paid_inst_records_threshold" value="4" />
            <where>id = 9</where>
        </update>
    </changeSet>

    <changeSet id="2018-07-26:new-apr-calculation" author="oliver">
        <comment>CRM-215</comment>
        <addColumn tableName="loan_apr">
            <column name="apr_advanced" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>


    <changeSet id="2018-07-17:refund_within_17_days-ALL" author="reimo">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="country_configuration" columnName="long_value"/>
            </not>
        </preConditions>

        <sqlFile path="scripts/CRM-138-refund_within_17_days_functionality_should_be_configurable-ALL.sql"/>
    </changeSet>

    <changeSet id="2018-07-17:refund_within_17_days-MOLDOVA" author="reimo" context="moldova">
        <sqlFile path="scripts/CRM-138-refund_within_17_days_functionality_should_be_configurable-MOLDOVA.sql"/>
    </changeSet>

    <changeSet id="2018-07-17:refund_within_17_days-KOSOVO" author="reimo" context="kosovo">
        <sqlFile path="scripts/CRM-138-refund_within_17_days_functionality_should_be_configurable-KOSOVO.sql"/>
    </changeSet>

    <changeSet id="2018-07-26:add-property-table" author="argo">
        <createTable tableName="property">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="country_config_id" type="BIGINT"></column>
            <column name="type" type="varchar(50)"></column>
            <column name="boolean_value" type="BOOLEAN" defaultValue="null"></column>
            <column name="long_value" type="BIGINT" defaultValue="null"></column>
        </createTable>

        <sqlFile path="scripts/CRM-138-move-property-values-to-property-table.sql" splitStatements="false"/>

        <dropColumn tableName="country_configuration" columnName="boolean_value"/>
        <dropColumn tableName="country_configuration" columnName="long_value"/>
    </changeSet>

    <changeSet id="2018-07-26:add-config-descriptions" author="argo">
        <addColumn tableName="country_configuration">
            <column name="description" type="varchar(512)" />
        </addColumn>
        <sqlFile path="scripts/CRM-138-add-config-descriptions.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-07-27:add-car-loans" author="oliver" context="kosovo">
        <sqlFile path="scripts/CRM-225-car-loans-kos.sql"/>
    </changeSet>

    <changeSet id="2018-08-03-crm-243" author="Oliver Kell" context="macedonia">
        <comment>CRM-243 - FFF dealer in Macedonia</comment>
        <insert tableName="loan_products">
            <column name="id" value="10" />
            <column name="admission_fee_perc" value="0" />
            <column name="max_apr" value="0" />
            <column name="max_interest" value="0" />
            <column name="max_loan_period" value="1" />
            <column name="max_principal" value="10000" />
            <column name="min_apr" value="0" />
            <column name="min_interest" value="0" />
            <column name="min_loan_period" value="1" />
            <column name="min_principal" value="1000" />
            <column name="name" value="FFF Dealer" />
            <column name="pm_default" value="false" />
            <column name="req_id_copy" value="true" />
            <column name="req_salary_cert" value="false" />
            <column name="type" value="dealer" />
            <column name="salary_ratio_regular" value="50" />
            <column name="salary_ratio_second_active" value="0" />
            <column name="salary_ratio_unofficial" value="0" />
            <column name="guarantee_product" value="false" />
            <column name="paid_inst_records_threshold" value="4" />
            <column name="turnover_threshold" value="0" />
            <column name="max_suspended_days" value="17" />
            <column name="official_paid_inst_records_threshold" value="4" />
            <column name="official_turnover_threshold" value="3" />
            <column name="official_paid_inst_records_threshold_office" value="4" />
            <column name="official_turnover_threshold_office" value="0" />
            <column name="paid_inst_records_threshold_office" value="4" />
            <column name="turnover_threshold_office" value="0" />
            <column name="enabled" value="false" />
            <column name="car_loan" value="false" />
            <column name="max_car_value_perc" value="0" />
            <column name="requires_data_verification" value="false" />
            <column name="requesting_fix_amount_by_sms_mandatory" value="false" />
        </insert>

        <insert tableName="loan_product_settings">
            <column name="allow_cash_release_duration" value="30" />
            <column name="checking_duration" value="45" />
            <column name="check_score_duration" value="30" />
            <column name="scoring_duration" value="15" />
            <column name="notify_client_duration" value="15" />
            <column name="pay_out_duration" value="60" />
            <column name="type" value="general" />
            <column name="upload_agreement_duration" value="15" />
            <column name="vip" value="false" />
            <column name="loan_product_id" value="10" />
            <column name="bonus_task_duration_until_paid_out" value="30" />
        </insert>
    </changeSet>
    <changeSet id="2018-08-03:sms-messages" author="oliver" >
        <comment>CRM-247 - SMS messages</comment>
        <createTable tableName="sms_due_date">
            <column name="id" autoIncrement="true" type="serial">
                <constraints primaryKey="true" />
            </column>
            <column name="language" type="varchar(10)">
                <constraints nullable="false" />
            </column>
            <column name="message" type="varchar(500)">
                <constraints nullable="false" />
            </column>
            <column name="enabled" type="boolean" defaultValueBoolean="true">
                <constraints nullable="false" />
            </column>
            <column name="days_before" type="int" />
        </createTable>
        <addUniqueConstraint
                columnNames="language, days_before"
                constraintName="sms_due_date_unique_language_days_before"
                tableName="sms_due_date" />
    </changeSet>

    <changeSet id="2018-08-06:sms-messages-al" author="oliver" context="albania">
        <comment>CRM-247 - SMS messages initial configuration</comment>
        <insert tableName="sms_due_date">
            <column name="language" value="ALBANIAN" />
            <column name="enabled" value="true" />
            <column name="days_before" value="3" />
            <column name="message" value="I nderuar Klient, Pagesa e kestit te kredise [ref_nr] ne IuteCredit eshte ne [payment_date] ne shumen [amount] lek. Ju lutem paguani ne kohe per te evituar penalitet!" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-06:sms-messages-ko" author="oliver" context="kosovo">
        <comment>CRM-247 - SMS messages initial configuration</comment>
        <insert tableName="sms_due_date">
            <column name="language" value="ALBANIAN" />
            <column name="enabled" value="true" />
            <column name="days_before" value="3" />
            <column name="message" value="Qe te keni histori te mire kreditore, ju lutemi paguani kredine ne kohe. Shuma [amount] Eur e kredise nr [ref_nr] duhet paguar ne daten [payment_date]. Faleminderit!" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-07:sms-messages-mk" author="oliver" context="macedonia">
        <comment>CRM-247 - SMS messages initial configuration</comment>
        <insert tableName="sms_due_date">
            <column name="language" value="MACEDONIAN" />
            <column name="enabled" value="true" />
            <column name="days_before" value="3" />
            <column name="message" value="Za da imate dobra kreditna istorija, ve molime vrsete uplati navremeno! Iznos [amount] MKD, kredit br. [ref_nr], najdocna do datum [payment_date]. Vi blagodarime!" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-07:sms-messages-md" author="oliver" context="moldova">
        <comment>CRM-247 - SMS messages initial configuration</comment>
        <insert tableName="sms_due_date">
            <column name="language" value="ENGLISH" />
            <column name="enabled" value="true" />
            <column name="days_before" value="3" />
            <column name="message" value="Payment day for your loan nr [ref_nr] is [payment_date]. If you repay on [payment_date], your payment will be [amount] mdl. Please pay in time!" />
        </insert>
        <insert tableName="sms_due_date">
            <column name="language" value="ROMANIAN" />
            <column name="enabled" value="true" />
            <column name="days_before" value="3" />
            <column name="message" value="Ziua de plata pentru imprumutul [ref_nr] este [payment_date]. Daca achitati pe [payment_date], suma spre plata este [amount] mdl. Va rugam sa achitati la timp!" />
        </insert>
        <insert tableName="sms_due_date">
            <column name="language" value="RUSSIAN" />
            <column name="enabled" value="true" />
            <column name="days_before" value="3" />
            <column name="message" value="[payment_date] vash deni oplaty po zaimu [ref_nr]. Pri oplate [payment_date], summa k oplate - [amount] mdl. Prosim vas oplatiti vovremia!" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-07:sms-messages-trunc-dates" author="oliver">
        <comment>CRM-247 - SMS messages initial configuration</comment>
        <sql>
            UPDATE installment_table SET expected_date = date_trunc('day', expected_date);
        </sql>
    </changeSet>

    <changeSet id="2018-08-08:sms-messages-delete-data-first" author="oliver" context="macedonia">
        <comment>CRM-247 - SMS messages delete data for batch 2</comment>
        <sql>
            DELETE FROM doc_template_loan_product WHERE template_id = (select id from doc_template where type = 'due_date_sms');
        </sql>
    </changeSet>

    <changeSet id="2018-08-08:sms-messages-delete-data" author="oliver">
        <comment>CRM-247 - SMS messages delete data for batch 2</comment>
        <sql>
            DELETE FROM sms_due_date;
            DELETE FROM doc_template WHERE type = 'due_date_sms';
        </sql>
    </changeSet>

    <changeSet id="2018-08-08:sms-messages-restructure" author="oliver">
        <comment>CRM-247 - SMS messages restructuring</comment>
        <dropColumn columnName="message" tableName="sms_due_date" />
        <addColumn tableName="sms_due_date">
            <column name="doc_template_id" type="int4">
                <constraints nullable="false" />
            </column>
        </addColumn>
        <addForeignKeyConstraint baseColumnNames="doc_template_id"
                                 baseTableName="sms_due_date"
                                 constraintName="fk_doc_template"
                                 referencedColumnNames="id"
                                 referencedTableName="doc_template"/>
    </changeSet>

    <changeSet id="2018-07-25:update-overdue-settings" author="risto" context="kosovo">
        <sql>
            UPDATE overdue_process_settings set delay_interest_source = 'PRINCIPAL';
        </sql>
    </changeSet>

    <changeSet id="2018-08-09:sms-messages-increase-send-to-number-column-length" author="argo">
        <modifyDataType
                columnName="sendtonumber"
                newDataType="varchar(15)"
                tableName="smsmessages"/>
    </changeSet>

    <changeSet id="2018-07-27:add-integration-logger" author="argo">
        <createTable tableName="integration_log">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="created" type="timestamp"/>
            <column name="method" type="varchar(25)"/>
            <column name="endpoint" type="varchar(512)"/>
            <column name="param_content" type="text"/>
            <column name="from_ip" type="varchar(45)"/>
        </createTable>

        <createIndex tableName="integration_log" indexName="integration_log_created_index">
            <column name="created"></column>
        </createIndex>
    </changeSet>

    <changeSet id="2018-08-07:integration-logger-feature-toggle" author="argo">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('integrationLogger', 0, 'Enable/Disable logging for all integration requests', NULL, NULL,NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-08-15-crm-272" author="Oliver Kell" context="albania">
        <comment>CRM-272 - Fidel Final in Albania</comment>
        <insert tableName="loan_products">
            <column name="id" value="13" />
            <column name="admission_fee_perc" value="34" />
            <column name="max_apr" value="350" />
            <column name="max_interest" value="17" />
            <column name="max_loan_period" value="8" />
            <column name="max_principal" value="100000" />
            <column name="min_apr" value="90" />
            <column name="min_interest" value="8.5" />
            <column name="min_loan_period" value="1" />
            <column name="min_principal" value="5000" />
            <column name="name" value="Fidel Final" />
            <column name="pm_default" value="false" />
            <column name="req_id_copy" value="true" />
            <column name="req_salary_cert" value="false" />
            <column name="suspension_fee" value="500" />
            <column name="type" value="regular" />
            <column name="salary_ratio_regular" value="33.4" />
            <column name="salary_ratio_second_active" value="40" />
            <column name="salary_ratio_unofficial" value="33.4" />
            <column name="guarantee_fee_perc" value="0.25" />
            <column name="guarantee_max_period" value="999" />
            <column name="guarantee_product" value="true" />
            <column name="paid_inst_records_threshold" value="4" />
            <column name="turnover_threshold" value="0" />
            <column name="max_suspended_days" value="17" />
            <column name="official_paid_inst_records_threshold" value="4" />
            <column name="official_turnover_threshold" value="0" />
            <column name="salary_cert_limit" value="50000.1" />
            <column name="official_paid_inst_records_threshold_office" value="4" />
            <column name="official_turnover_threshold_office" value="0" />
            <column name="paid_inst_records_threshold_office" value="4" />
            <column name="turnover_threshold_office" value="0" />
            <column name="enabled" value="false" />
            <column name="car_loan" value="false" />
            <column name="max_car_value_perc" value="0" />
            <column name="guarantee_monthly_max" value="200" />
            <column name="requires_data_verification" value="false" />
            <column name="requesting_fix_amount_by_sms_mandatory" value="false" />
        </insert>

        <insert tableName="loan_product_settings">
            <column name="allow_cash_release_duration" value="30" />
            <column name="checking_duration" value="45" />
            <column name="check_score_duration" value="30" />
            <column name="scoring_duration" value="15" />
            <column name="notify_client_duration" value="15" />
            <column name="pay_out_duration" value="60" />
            <column name="type" value="general" />
            <column name="upload_agreement_duration" value="15" />
            <column name="vip" value="false" />
            <column name="loan_product_id" value="13" />
            <column name="bonus_task_duration_until_paid_out" value="30" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-17-crm-272" author="oliver" context="albania">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from doc_template where id = 2</sqlCheck>
        </preConditions>
        <sqlFile path="scripts/CRM-272-fidel-final.sql"/>
    </changeSet>

    <changeSet id="2018-08-21:dealer-double-check-country-conf" author="oliver">
        <comment>CRM-269 - Make dealer documents double check configurable</comment>
        <insert tableName="country_configuration">
            <column name="property" value="double_check_documents" />
            <column name="property_group" value="dealer" />
            <column name="description" value="Should accountant also check documents (double check since print center already does aswell)" />
        </insert>

        <insert tableName="property">
            <column name="country_config_id" valueComputed="(select id from country_configuration where property_group = 'dealer' and property = 'double_check_documents')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-15:sms-messages-comfort-alb" author="oliver" context="albania">
        <comment>CRM-222 - comfort SMS doc templates</comment>
        <sqlFile path="scripts/CRM-222-comfort-smses-alb.sql"/>
    </changeSet>

    <changeSet id="2018-08-15:sms-messages-comfort-kos" author="oliver" context="kosovo">
        <comment>CRM-222 - comfort SMS doc templates</comment>
        <sqlFile path="scripts/CRM-222-comfort-smses-kos.sql"/>
    </changeSet>

    <changeSet id="2018-08-15:sms-messages-comfort-mol" author="oliver" context="moldova">
        <comment>CRM-222 - comfort SMS doc templates</comment>
        <sqlFile path="scripts/CRM-222-comfort-smses-mol.sql"/>
    </changeSet>

    <changeSet id="2018-08-16:sms-due-date-initial-data" author="oliver" context="albania">
        <comment>CRM-253 - SMS due date initial data</comment>
        <sql>
            <![CDATA[
                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>I nderuar Klient, Pagesa e kestit te kredise [ref_nr] ne IuteCredit eshte ne [payment_date] ne shumen [amount] lek. Ju lutem paguani ne kohe per te evituar penalitet!</p>',
                now(), 'Due date SMS', 'alb', 'due_date_sms', 'sms');

                INSERT INTO sms_due_date (language, enabled, days_before, doc_template_id) VALUES ('ALBANIAN', true, 3, (SELECT id FROM doc_template WHERE type = 'due_date_sms' and lang = 'alb'));
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-08-16:sms-due-date-initial-data-kos" author="oliver" context="kosovo">
        <comment>CRM-253 - SMS due date initial data</comment>
        <sql>
            <![CDATA[
                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>Qe te keni histori te mire kreditore, ju lutemi paguani kredine ne kohe. Shuma [amount] Eur e kredise nr [ref_nr] duhet paguar ne daten [payment_date]. Faleminderit!</p>',
                now(), 'Due date SMS', 'alb', 'due_date_sms', 'sms');

                INSERT INTO sms_due_date (language, enabled, days_before, doc_template_id) VALUES ('ALBANIAN', true, 3, (SELECT id FROM doc_template WHERE type = 'due_date_sms' and lang = 'alb'));
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-08-16:sms-due-date-initial-data-mk" author="oliver" context="macedonia">
        <comment>CRM-253 - SMS due date initial data</comment>
        <sql>
            <![CDATA[
                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>Za da imate dobra kreditna istorija, ve molime vrsete uplati navremeno! Iznos [amount] MKD, kredit br. [ref_nr], najdocna do datum [payment_date]. Vi blagodarime!</p>',
                now(), 'Due date SMS', 'mac', 'due_date_sms', 'sms');

                INSERT INTO sms_due_date (language, enabled, days_before, doc_template_id) VALUES ('MACEDONIAN', true, 3, (SELECT id FROM doc_template WHERE type = 'due_date_sms' and lang = 'mac'));
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-08-16:sms-due-date-initial-data-mol" author="oliver" context="moldova">
        <comment>CRM-253 - SMS due date initial data</comment>
        <sql>
            <![CDATA[
                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>Ziua de plata pentru imprumutul [ref_nr] este [payment_date]. Daca achitati pe [payment_date], suma spre plata este [amount] mdl. Va rugam sa achitati la timp!</p>',
                now(), 'Due date SMS', 'rom', 'due_date_sms', 'sms');

                INSERT INTO sms_due_date (language, enabled, days_before, doc_template_id) VALUES ('ROMANIAN', true, 3, (SELECT id FROM doc_template WHERE type = 'due_date_sms' and lang = 'rom'));

                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>[payment_date] vash deni oplaty po zaimu [ref_nr]. Pri oplate [payment_date], summa k oplate - [amount] mdl. Prosim vas oplatiti vovremia!</p>',
                now(), 'Due date SMS', 'rus', 'due_date_sms', 'sms');

                INSERT INTO sms_due_date (language, enabled, days_before, doc_template_id) VALUES ('RUSSIAN', true, 3, (SELECT id FROM doc_template WHERE type = 'due_date_sms' and lang = 'rus'));

                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>Payment day for your loan nr [ref_nr] is [payment_date]. If you repay on [payment_date], your payment will be [amount] mdl. Please pay in time!</p>',
                now(), 'Due date SMS', 'eng', 'due_date_sms', 'sms');

                INSERT INTO sms_due_date (language, enabled, days_before, doc_template_id) VALUES ('ENGLISH', true, 3, (SELECT id FROM doc_template WHERE type = 'due_date_sms' and lang = 'eng'));
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-08-17:add-easy-pay-config" author="argo">
        <insert tableName="country_configuration">
            <column name="property_group" value="partner"></column>
            <column name="property" value="easy_pay"></column>
            <column name="description" value="Activates 'easy_pay' functionality in CRM"></column>
        </insert>

        <insert tableName="property">
            <column name="type" value="boolean"></column>
            <column name="boolean_value" value="false"></column>
            <column name="country_config_id" valueComputed="(select id from country_configuration where property_group='partner' and property='easy_pay')"></column>
        </insert>
    </changeSet>

    <changeSet id="2018-08-09:add-task-balancer" author="argo">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('task-balancer', 0, 'Activate balancer for reminder call and aftersale call tasks', null, null,null);
        </sql>

        <createTable tableName="task_balancer_config">
            <column name="id" autoIncrement="true" type="serial">
                <constraints primaryKey="true" />
            </column>
            <column name="name" type="varchar(50)">
                <constraints nullable="false" />
            </column>
        </createTable>

        <createTable tableName="task_balancer_group">
            <column name="id" autoIncrement="true" type="serial">
                <constraints primaryKey="true" />
            </column>
            <column name="task_name" type="varchar(50)">
                <constraints nullable="false" />
            </column>
            <column name="default_role" type="varchar(50)">
                <constraints nullable="false" />
            </column>
            <column name="task_balancer_config_id" type="int">
                <constraints foreignKeyName="id" references="task_balancer_config" nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="task_balancer_proportion">
            <column name="id" autoIncrement="true" type="serial">
                <constraints primaryKey="true" />
            </column>
            <column name="user_role" type="varchar(50)">
                <constraints nullable="false" />
            </column>
            <column name="proportion" type="int" />
            <column name="task_balancer_group_id" type="int">
                <constraints foreignKeyName="id" references="task_balancer_group" nullable="false"/>
            </column>
        </createTable>

        <insert tableName="task_balancer_config">
            <column name="name" value="First config for task balancer"/>
        </insert>

        <insert tableName="task_balancer_group">
            <column name="task_name" value="Ask if still wants"/>
            <column name="task_balancer_config_id" valueComputed="(select MAX(id) from task_balancer_config)"/>
            <column name="default_role" value="CALL"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CALL"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CREDIT"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="SOFT_CALL_REM"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>

        <insert tableName="task_balancer_group">
            <column name="task_name" value="First reminder call"/>
            <column name="task_balancer_config_id" valueComputed="(select MAX(id) from task_balancer_config)"/>
            <column name="default_role" value="CALL"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CALL"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CREDIT"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="SOFT_CALL_REM"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>

        <insert tableName="task_balancer_group">
            <column name="task_name" value="Second reminder call"/>
            <column name="task_balancer_config_id" valueComputed="(select MAX(id) from task_balancer_config)"/>
            <column name="default_role" value="CALL"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CALL"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CREDIT"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="SOFT_CALL_REM"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>

        <insert tableName="task_balancer_group">
            <column name="task_name" value="Third reminder call"/>
            <column name="task_balancer_config_id" valueComputed="(select MAX(id) from task_balancer_config)"/>
            <column name="default_role" value="CALL"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CALL"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CREDIT"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="SOFT_CALL_REM"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>

        <insert tableName="task_balancer_group">
            <column name="task_name" value="Fourth reminder call"/>
            <column name="task_balancer_config_id" valueComputed="(select MAX(id) from task_balancer_config)"/>
            <column name="default_role" value="CALL"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CALL"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CREDIT"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="SOFT_CALL_REM"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
    </changeSet>

    <changeSet id="2018-08-23:remove-4th-reminder-call-group" author="argo">
        <sql>
            DELETE FROM task_balancer_proportion where task_balancer_group_id = (SELECT id FROM task_balancer_group where task_name = 'Fourth reminder call');
            DELETE FROM task_balancer_group where task_name = 'Fourth reminder call';
        </sql>
    </changeSet>

    <changeSet id="2018-07-26:remove-campaign-client-cache" author="ivar">
        <sqlFile path="CRM-200-remove-campaign-client-cache.sql"/>
    </changeSet>

    <changeSet id="2018-08-28:add-barcode-feature-toggle" author="argo">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('barcode-generation', 0, 'enable/disable barcode generation', NULL, NULL, NULL);
        </sql>
    </changeSet>


    <changeSet id="2018-07-03:add-customer-configuration" author="argo">

        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="customer_configuration"/>
            </not>
        </preConditions>

        <createTable tableName="customer_configuration">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="loan_product_id" type="bigint"/>
            <column name="available" type="boolean" defaultValueBoolean="false"/>
        </createTable>

        <createTable tableName="customer_description">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="customer_configuration_id" type="bigint"/>
            <column name="language" type="varchar(3)"/>
            <column name="description" type="varchar(500)"/>
        </createTable>
    </changeSet>

    <changeSet id="2018-07-05:add-languages-to-country-configuration" author="argo">
        <insert tableName="country_configuration">
            <column name="property_group" value="customer_config"/>
            <column name="property" value="language.eng" />
            <column name="description" value="Enables translations for english language" />
        </insert>
        <insert tableName="property">
            <column name="country_config_id"
                    valueComputed="(select id from country_configuration where property_group='customer_config' and property='language.eng')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>

        <insert tableName="country_configuration">
            <column name="property_group" value="customer_config"/>
            <column name="property" value="language.rus" />
            <column name="description" value="Enables translations for russian language" />
        </insert>
        <insert tableName="property">
            <column name="country_config_id"
                    valueComputed="(select id from country_configuration where property_group='customer_config' and property='language.rus')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>

        <insert tableName="country_configuration">
            <column name="property_group" value="customer_config"/>
            <column name="property" value="language.sqi" />
            <column name="description" value="Enables translations for albanian language" />
        </insert>
        <insert tableName="property">
            <column name="country_config_id"
                    valueComputed="(select id from country_configuration where property_group='customer_config' and property='language.sqi')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>

        <insert tableName="country_configuration">
            <column name="property_group" value="customer_config"/>
            <column name="property" value="language.mkd" />
            <column name="description" value="Enables translations for macedonian language" />
        </insert>
        <insert tableName="property">
            <column name="country_config_id"
                    valueComputed="(select id from country_configuration where property_group='customer_config' and property='language.mkd')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>

        <insert tableName="country_configuration">
            <column name="property_group" value="customer_config"/>
            <column name="property" value="language.ron" />
            <column name="description" value="Enables translations for romanian language" />
        </insert>
        <insert tableName="property">
            <column name="country_config_id"
                    valueComputed="(select id from country_configuration where property_group='customer_config' and property='language.ron')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-15-crm-272" author="Oliver Kell" context="albania">
        <comment>CRM-272 - Fidel Final in Albania</comment>
        <insert tableName="loan_products">
            <column name="id" value="13" />
            <column name="admission_fee_perc" value="34" />
            <column name="max_apr" value="350" />
            <column name="max_interest" value="17" />
            <column name="max_loan_period" value="8" />
            <column name="max_principal" value="100000" />
            <column name="min_apr" value="90" />
            <column name="min_interest" value="8.5" />
            <column name="min_loan_period" value="1" />
            <column name="min_principal" value="5000" />
            <column name="name" value="Fidel Final" />
            <column name="pm_default" value="false" />
            <column name="req_id_copy" value="true" />
            <column name="req_salary_cert" value="false" />
            <column name="suspension_fee" value="500" />
            <column name="type" value="regular" />
            <column name="salary_ratio_regular" value="33.4" />
            <column name="salary_ratio_second_active" value="40" />
            <column name="salary_ratio_unofficial" value="33.4" />
            <column name="guarantee_fee_perc" value="0.25" />
            <column name="guarantee_max_period" value="999" />
            <column name="guarantee_product" value="true" />
            <column name="paid_inst_records_threshold" value="4" />
            <column name="turnover_threshold" value="0" />
            <column name="max_suspended_days" value="17" />
            <column name="official_paid_inst_records_threshold" value="4" />
            <column name="official_turnover_threshold" value="0" />
            <column name="salary_cert_limit" value="50000.1" />
            <column name="official_paid_inst_records_threshold_office" value="4" />
            <column name="official_turnover_threshold_office" value="0" />
            <column name="paid_inst_records_threshold_office" value="4" />
            <column name="turnover_threshold_office" value="0" />
            <column name="enabled" value="false" />
            <column name="car_loan" value="false" />
            <column name="max_car_value_perc" value="0" />
            <column name="guarantee_monthly_max" value="200" />
            <column name="requires_data_verification" value="false" />
            <column name="requesting_fix_amount_by_sms_mandatory" value="false" />
        </insert>

        <insert tableName="loan_product_settings">
            <column name="allow_cash_release_duration" value="30" />
            <column name="checking_duration" value="45" />
            <column name="check_score_duration" value="30" />
            <column name="scoring_duration" value="15" />
            <column name="notify_client_duration" value="15" />
            <column name="pay_out_duration" value="60" />
            <column name="type" value="general" />
            <column name="upload_agreement_duration" value="15" />
            <column name="vip" value="false" />
            <column name="loan_product_id" value="13" />
            <column name="bonus_task_duration_until_paid_out" value="30" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-17-crm-272" author="oliver" context="albania">
        <sqlFile path="scripts/CRM-272-fidel-final.sql"/>
    </changeSet>

    <changeSet id="2018-08-21:dealer-double-check-country-conf" author="oliver">
        <comment>CRM-269 - Make dealer documents double check configurable</comment>
        <insert tableName="country_configuration">
            <column name="property" value="double_check_documents" />
            <column name="property_group" value="dealer" />
            <column name="description" value="Should accountant also check documents (double check since print center already does aswell)" />
        </insert>

        <insert tableName="property">
            <column name="country_config_id" valueComputed="(select id from country_configuration where property_group = 'dealer' and property = 'double_check_documents')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-24:new-pay-out-role" author="oliver">
        <comment>CRM-271 - PAY OUT role</comment>
        <sql>
            INSERT INTO user_role (user_id, role) SELECT user_id, 'ROLE_PAY_OUT' FROM user_role WHERE role = 'ROLE_ACCOUNTING';
        </sql>
    </changeSet>

    <changeSet id="2018-08-08:add-automatic-collection-column" author="argo">
        <addColumn tableName="collection_company">
            <column name="automatic_collection" type="boolean" defaultValue="false"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-06-08:add-external-collection-country-configuration" author="argo">
        <sql splitStatements="false">
            <![CDATA[
            INSERT INTO "country_configuration"
            ("property", "property_group", "description")
            VALUES ('automatic_external_collection', 'restructure', 'Whether restructured loans are sent to external collection automatically or not.
                <br/>NB! make sure to choose at least on collection company for automatic collection from
                <br/>Tools->Collection->Collection Settings->Edit collection company');
            ]]>
        </sql>
        <insert tableName="property">
            <column name="country_config_id" valueComputed="(select id from country_configuration where property_group='restructure' and property='automatic_external_collection')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="false" />
        </insert>
    </changeSet>

    <changeSet id="2018-08-30:add_barcode_row_to_bulk_letter" author="argo">
        <addColumn tableName="bulk_letter_task_row">
            <column name="barcode_nr" type="varchar(20)" />
        </addColumn>
    </changeSet>

    <changeSet id="2018-09-05:aftersaleCampaignToggle" author="oleg">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('aftersaleCampaign', 0, 'Enable new aftersale campaign logic', NULL, NULL, NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-09-07:aftersaleCampaignTable" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <tableExists tableName="aftersale_campaign"/>
            </not>
        </preConditions>
        <sql>
            create table aftersale_campaign (
            id                     serial not null
            constraint aftersale_campaign_pkey
            primary key,
            description            varchar(255),
            name                   varchar(255),
            type                   varchar(255),
            day_limit               integer,
            last_touch_call         timestamp,
            last_touch_sms         timestamp,
            last_touch_letter         timestamp,
            last_touch_email         timestamp,
            has_active_loan     varchar,
            eligible_next_offer           varchar(511),
            role_call          boolean,
            role_credit        boolean,
            role_print         boolean,
            last_execution         timestamp,
            active                 boolean,
            created                timestamp,
            created_by             varchar(255));
        </sql>
    </changeSet>

    <changeSet id="2018-09-07:aftersaleCampaignClientRelation" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="campaign_client" columnName="aftersale_campaign_id"/>
            </not>
        </preConditions>
        <sql>
            alter table campaign_client add column aftersale_campaign_id integer constraint fk_aftersale_campaign_client references aftersale_campaign;
        </sql>
    </changeSet>

    <changeSet id="2018-09-07:aftersaleCampaignClientTouchType" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="campaign_client" columnName="touch_type"/>
            </not>
        </preConditions>
        <sql>
            alter table campaign_client add column touch_type varchar(10);
        </sql>
    </changeSet>

    <changeSet id="2018-09-12:aftersaleCampaignClient" author="oleg">
        <preConditions onFail="MARK_RAN">
            <columnExists tableName="campaign_client" columnName="campaign_id"/>
        </preConditions>
        <sql>
            alter table campaign_client alter column campaign_id drop not null;
        </sql>
    </changeSet>

    <changeSet id="2018-09-05:add-feature-toggle-for-delay-interest-job" author="argo">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('delay-interest-job', 1, 'Enable/disable delay interest job for application', NULL, NULL, NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-09-03:add-4th-rem-call-group-back-for-task-balancer" author="argo">
        <insert tableName="task_balancer_group">
            <column name="task_name" value="Fourth reminder call"/>
            <column name="task_balancer_config_id" valueComputed="(select MAX(id) from task_balancer_config)"/>
            <column name="default_role" value="CALL"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CALL"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="CREDIT"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
        <insert tableName="task_balancer_proportion">
            <column name="user_role" value="SOFT_CALL_REM"/>
            <column name="task_balancer_group_id" valueComputed="(select MAX(id) from task_balancer_group)"/>
        </insert>
    </changeSet>



    <changeSet id="2018-09-05:add-data-consent-property" author="argo">
        <comment>CRM-330 - Make data consent check configurable for web integration applications</comment>
        <insert tableName="country_configuration">
            <column name="property" value="data_consent_mandatory_web_integration" />
            <column name="property_group" value="files" />
            <column name="description" value="Whether data consent(Data Verification) file is mandatory for loan applications where source is 'web'" />
        </insert>

        <insert tableName="property">
            <column name="country_config_id" valueComputed="(select id from country_configuration where property_group = 'files' and property = 'data_consent_mandatory_web_integration')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>
    </changeSet>

    <changeSet id="2018-09-05:disable-data-consent-files-for-albania" author="argo" context="albania">
        <update tableName="property">
            <column name="boolean_value" value="false"></column>
            <where>country_config_id=:value</where>
            <whereParams>
                <param valueComputed="(select id from country_configuration where property_group = 'files' and property = 'data_consent_mandatory_web_integration')"></param>
            </whereParams>
        </update>
    </changeSet>

    <changeSet id="2018-10-13:add-client-age-limit" author="oleg">
        <comment>CRM-293 [ICA] Updates for pensioners</comment>
        <insert tableName="country_configuration">
            <column name="property" value="age_limit" />
            <column name="property_group" value="client" />
            <column name="description" value="Age limit for pensioners" />
        </insert>

        <insert tableName="property">
            <column name="country_config_id" valueComputed="(select id from country_configuration where property_group = 'client' and property = 'age_limit')" />
            <column name="type" value="long" />
            <column name="long_value" value="69" />
        </insert>
    </changeSet>

    <changeSet id="2018-09-18-crm-361" author="argo" context="albania">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from doc_template where id = 22</sqlCheck>
        </preConditions>
        <sqlFile path="scripts/CRM-361-fidel-dealer-albania.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-09-21:change-admin-fee-period-wo-type" author="risto">
        <sql>
            ALTER TABLE loan_application ALTER COLUMN admin_fee_period_wo TYPE integer;
        </sql>
    </changeSet>

    <changeSet id="2018-09-27:add-feature-toggle-for-high-priority-task-job" author="risto">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('high-priority-task-job', 0, 'Enable/disable high priority task distributor job for application', NULL, NULL, NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-10-09:addNextOffersCreatedColumn" author="ivar">
        <addColumn tableName="client_next_offer">
            <column name="created" type="TIMESTAMP" defaultValueComputed="now()">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2018-09-19-crm-124-mintos-behind-feature-toggle" author="argo">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('mintos', 0, 'Enable/Disable mintos functionality', NULL, NULL,NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-09-19-crm-124-enable-mintos-for-albania" author="argo" context="albania">
        <update tableName="ff4j_features">
            <column name="enable" value="1"></column>
            <where>feat_uid='mintos'</where>
        </update>
    </changeSet>

    <changeSet id="2018-09-19-crm-124-enable-mintos-for-moldova" author="argo" context="moldova">
        <update tableName="ff4j_features">
            <column name="enable" value="1"></column>
            <where>feat_uid='mintos'</where>
        </update>
    </changeSet>

    <changeSet id="2018-10-22-crm-491-add-neptun-feature-toggle" author="argo">
        <sql>
            INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('neptun', 0, 'Enable/Disable Neptun functionality', NULL, NULL,NULL);
        </sql>
    </changeSet>

    <changeSet id="2018-10-25-crm-491-neptun-preapproval-list" author="argo" context="albania">
        <createTable tableName="neptun_preapproval">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="imported_at" type="timestamp without timezone">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="neptun_client">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="first_name" type="varchar(100)">
                <constraints nullable="false"/>
            </column>
            <column name="last_name" type="varchar(100)">
                <constraints nullable="false"/>collection_conditions
            </column>
            <column name="birth_date" type="timestamp without timezone">
                <constraints nullable="false"/>
            </column>
            <column name="client_pin" type="varchar(50)"/>
            <column name="neptun_approval_client_id" type="bigint"/>
        </createTable>

    </changeSet>

    <changeSet id="2018-09-18-crm-492-add-neptun-product" author="argo" context="albania">
        <preConditions onFail="MARK_RAN">
            <sqlCheck expectedResult="1">select count(*) from doc_template where id = 22</sqlCheck>
        </preConditions>
        <sqlFile path="scripts/CRM-492-happy-neptun-product.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2018-10-24-crm-492-make-checking-links-configurable" author="argo">
        <addColumn tableName="loan_products">
            <column name="checking_links_mandatory" type="boolean" defaultValue="true"/>
        </addColumn>

        <update tableName="loan_products">
            <column name="checking_links_mandatory" type="boolean" value="false"/>
            <where>id in (50, 107)</where>
        </update>

    </changeSet>

    <changeSet id="2018-10-24:rename-comfort-sms-paidout-template" author="oleg">
        <sql>
            update doc_template set type = 'paidout_sms' where type = 'comfort_paidout_sms';
        </sql>
    </changeSet>

    <changeSet id="2018-10-24:sms-messages-cash-dealer-mac" author="oleg" context="macedonia">
        <sqlFile path="scripts/CRM-453-cash-dealer-smses-mac.sql"/>
    </changeSet>

    <changeSet id="2018-10-24:sms-messages-cash-dealer-mold" author="oleg" context="moldova">
        <sqlFile path="scripts/CRM-453-cash-dealer-smses-mold.sql"/>
    </changeSet>


    <changeSet id="2018-10-24:sms-messages-cash-dealer-alb-kos" author="oleg" context="albania,kosovo">
        <sqlFile path="scripts/CRM-453-cash-dealer-smses-alb-kos.sql"/>
    </changeSet>

    <changeSet id="2018-10-29:sms-messages-confirmation" author="oleg" context="macedonia">
        <sql>
            <![CDATA[
                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES ('<p>Potpisuvanjeto na Dogovorot e uspesno! Odobreniot iznos kje bide prefrlen na Vasata transakciska smetka.</p>', now(), 'Signing success sms', 'mac', 'signing_success_sms', 'sms');
                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES ('<p>The signing of the contract was successful. The approved amount will be transferred to your bank account.</p>', now(), 'Signing success sms', 'eng', 'signing_success_sms', 'sms');
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-10-29:sms-messages-confirmation" author="oleg" context="moldova,albania,kosovo">
        <sql>
            <![CDATA[
                INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES ('<p>The signing of the contract was successful. The approved amount will be transferred to your bank account.</p>', now(), 'Signing success sms', 'eng', 'signing_success_sms', 'sms');
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2018-11-01" author="argo" context="albania">
        <addColumn tableName="neptun_client">
            <column name="phone_number" type="varchar(25)">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2018-11-05:CRM-535-remove-mintos-from-power-options" author="argo">
        <addColumn tableName="users">
            <column name="developer" type="boolean" defaultValueBoolean="false">
                <constraints nullable="false"/>
            </column>
        </addColumn>
    </changeSet>

    <changeSet id="2018-11-15:aftersaleCampaignDueDate" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="aftersale_campaign" columnName="duration"/>
            </not>
        </preConditions>
        <sql>
            alter table aftersale_campaign add column duration integer default 1;
            update act_hi_taskinst set due_date_ = (start_time_ + interval '30 day') where name_ = 'Aftersale task' and due_date_ is null and end_time_ is null;
        </sql>
    </changeSet>

    <changeSet id="2018-11-16:updateCampaignClientMissingLoanAppIds" author="oleg">
        <sql>
            update campaign_client set loan_app_id = latest_la.id
            from (select DISTINCT ON (cl.pin) cl.pin as pin, la.id as id
            from client_profile cl
            left join loan_application la on cl.id = la.latest_client
            order by cl.pin, cl.created desc) latest_la
            where latest_la.pin = client_pin and loan_app_id is null and aftersale_campaign_id is not null and completed is null;
        </sql>
    </changeSet>

    <changeSet id="2018-11-20:add-notify-client-reject-property" author="ivar">
        <comment>CRM-564 notify clients if rejected</comment>
        <insert tableName="country_configuration">
            <column name="property" value="automatic_rejection_notification" />
            <column name="property_group" value="client" />
            <column name="description" value="Notify client when loan is rejected" />
        </insert>
        <insert tableName="country_configuration">
            <column name="property" value="disable_office_rejection_notification" />
            <column name="property_group" value="client" />
            <column name="description" value="Disable rejection notifications if client is in the office" />
        </insert>

        <insert tableName="property">
            <column name="country_config_id"
                    valueComputed="(select id from country_configuration where property_group = 'client' and property = 'automatic_rejection_notification')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>
        <insert tableName="property">
            <column name="country_config_id"
                    valueComputed="(select id from country_configuration where property_group = 'client' and property = 'disable_office_rejection_notification')" />
            <column name="type" value="boolean" />
            <column name="boolean_value" value="true" />
        </insert>
    </changeSet>

    <changeSet id="2018-11-20-crm-450-add-initial-restructure-contribution" author="argo">
        <addColumn tableName="loan_products">
            <column name="initial_restructured_contribution" type="numeric" defaultValueNumeric="0.0"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-11-22:CRM-567-withdrawn-card-to-last" author="risto">
        <addColumn tableName="card_data">
            <column name="ordering" type="integer" defaultValue="0"></column>
        </addColumn>
    </changeSet>

    <changeSet id="2018-11-26:CRM-593-nextoffer-toggle" author="dmitri">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) select 'nextOffer', 0, 'nextOffer slows down system, but nextOffer data is fresh', NULL, NULL, null
            where not exists (select * from ff4j_features where feat_uid='nextOffer');
        </sql>
    </changeSet>
    <changeSet id="2018-11-15:CRM-557-min-amount-repayment-for-bonus-customized" author="Giorgi">
        <sql>
            begin;
            INSERT INTO country_configuration (property, property_group, description)
            VALUES('minAmountForBonus', 'user', 'The amount of required repayment to issue a bonus after an effective reminder call');
            insert into property(country_config_id, type, boolean_value, long_value)
            values ((select max(id) from country_configuration),'long', false, null);
            commit;
        </sql>
    </changeSet>
    <changeSet id="2018-11-27:aftersaleCampaignConnectLoanDays" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not>
                <columnExists tableName="aftersale_campaign" columnName="connect_loan_days"/>
            </not>
        </preConditions>
        <sql>
            alter table aftersale_campaign add column connect_loan_days integer default 30;
        </sql>
    </changeSet>


    <changeSet id="2018-12-03:CRM-604-add-car-loan" author="ivar" context="macedonia">
        <comment>CRM-604 - Car loan (new owner) in Macedonia</comment>
        <insert tableName="loan_products">
            <column name="id" value="6" />
            <column name="admission_fee_perc" value="12" />
            <column name="max_apr" value="76.05" />
            <column name="max_interest" value="5" />
            <column name="max_loan_period" value="60" />
            <column name="max_principal" value="500000" />
            <column name="min_apr" value="35" />
            <column name="min_interest" value="0" />
            <column name="min_loan_period" value="3" />
            <column name="min_principal" value="30000" />
            <column name="name" value="Car Loan (New Owner)" />
            <column name="pm_default" value="false" />
            <column name="req_id_copy" value="true" />
            <column name="req_salary_cert" value="false" />
            <column name="type" value="regular" />
            <column name="salary_ratio_regular" value="55" />
            <column name="salary_ratio_second_active" value="60" />
            <column name="guarantee_product" value="false" />
            <column name="paid_inst_records_threshold" value="6" />
            <column name="max_suspended_days" value="17" />
            <column name="official_paid_inst_records_threshold" value="3" />
            <column name="official_paid_inst_records_threshold_office" value="6" />
            <column name="paid_inst_records_threshold_office" value="6" />
            <column name="enabled" value="false" />
            <column name="car_loan" value="true" />
            <column name="max_car_value_perc" value="80" />
            <column name="requires_data_verification" value="false" />
            <column name="requesting_fix_amount_by_sms_mandatory" value="false" />
        </insert>

        <insert tableName="loan_product_settings">
            <column name="allow_cash_release_duration" value="30" />
            <column name="checking_duration" value="45" />
            <column name="check_score_duration" value="30" />
            <column name="scoring_duration" value="15" />
            <column name="notify_client_duration" value="15" />
            <column name="pay_out_duration" value="60" />
            <column name="type" value="general" />
            <column name="upload_agreement_duration" value="15" />
            <column name="vip" value="false" />
            <column name="loan_product_id" value="6" />
            <column name="bonus_task_duration_until_paid_out" value="30" />
        </insert>
    </changeSet>
    <changeSet id="2018-12-18:dropTimeLog" author="ivar">
        <dropTable tableName="timelog"></dropTable>
    </changeSet>


    <changeSet id="2018-12-19:add-feature-toggle-for-new-customer-auto-approve" author="risto">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('new-customer-auto-approve', 0, 'Enable/disable new customer dealer loan auto approval', NULL, NULL, NULL);
        </sql>
    </changeSet>


    <changeSet id="2018-12-03:CRM-601-next-offer-settings" author="oleg">
        <createTable tableName="loan_product_next_offer_settings">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="loan_product_id" type="bigint">
                <constraints foreignKeyName="id" references="loan_products"/>
            </column>
            <column name="next_offer_loan_product_id" type="bigint"/>
            <column name="active" type="boolean" defaultValue="false"/>
            <column name="officially_active_loan_days" type="numeric"/>
            <column name="unofficially_active_loan_days" type="numeric"/>
            <column name="created" type="timestamp" defaultValueComputed="now()"/>
        </createTable>
    </changeSet>

    <changeSet id="2018-12-12:CRM-601-next-offer-custom-product" author="oleg">
        <addColumn tableName="loan_product_next_offer_settings">
            <column name="next_offer_custom_product_id" type="bigint"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-12-13:addNextOffersCustomProduct" author="oleg">
        <addColumn tableName="client_next_offer">
            <column name="next_custom_product_id" type="bigint"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-09-06:crm-332-mastercard-implementation" author="comul">
        <addColumn tableName="client_profile">
            <column name="id_document_type"     type="varchar(30)" defaultValue="id_card"/>
            <column name="idcard_issued_by"     type="varchar(80)" />
            <column name="idcard_issue_date"    type="timestamp" />
            <column name="idcard_expiry_date"   type="timestamp" />
            <column name="passport_nr"          type="varchar(40)" />
            <column name="passport_issued_by"   type="varchar(80)" />
            <column name="passport_issue_date"  type="timestamp" />
            <column name="passport_expiry_date" type="timestamp" />
            <column name="residency_status"     type="varchar(30)" defaultValue="resident"/>
            <column name="card_disabled"        type="boolean" defaultValue="false"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-11-07:add-feature-toggle-for-mastercard" author="comul">
        <sql>INSERT INTO ff4j_features (feat_uid, enable, description, strategy, expression, groupname) VALUES
            ('mastercard-chipcard', 1, 'Enable/disable mastercard/chipcard for application', NULL, NULL, NULL);
        </sql>
    </changeSet>


    <changeSet id="2019-01-07:add-admin-fee-conditin-to-regular-product" author="argo">
        <addColumn tableName="loan_product_condition">
            <column name="admin_fee_percent" type="numeric"/>
        </addColumn>
    </changeSet>

    <changeSet id="2018-12-12:CRM-702-remove-next-offer-settings" author="oleg">
        <sql>DELETE FROM loan_product_next_offer_settings WHERE next_offer_loan_product_id is null;</sql>
    </changeSet>

    <changeSet id="2019-01-15:add restored from withdrawn" author="oleg">
        <preConditions onFail="MARK_RAN">
            <not><columnExists tableName="loan_application" columnName="restored_from_withdrawn"/></not>
        </preConditions>
        <addColumn tableName="loan_application">
            <column name="restored_from_withdrawn" type="boolean default false"/>
        </addColumn>
    </changeSet>

    <changeSet id="2019-01-22:add_consent_field_to_loan_applications" author="argo">
        <addColumn tableName="loan_application">
            <column name="consent_given" type="boolean" defaultValueBoolean="false"/>
        </addColumn>

        <update tableName="loan_application">
            <column name="consent_given" value="true"/>
            <where>submitted > '2018-01-01' and submit_person = 'web'</where>
        </update>

    </changeSet>

    <changeSet id="2019-02-06:add-minAmountForBonus-property-not-kosovo" author="oleg" context="moldova,albania,macedonia">
        <sql>update property set long_value = 100 where country_config_id = (select id from country_configuration where property = 'minAmountForBonus');</sql>
    </changeSet>

    <changeSet id="2019-02-06:add-minAmountForBonus-property-kosovo" author="oleg" context="kosovo">
        <sql>update property set long_value = 2 where country_config_id = (select id from country_configuration where property = 'minAmountForBonus');</sql>
    </changeSet>


    <changeSet id="2019-01-22:countryCheckToFeatureToggleForNotMoldova" author="oleg" context="albania,kosovo,macedonia">
        <sqlFile path="scripts/2019-01-22-countryCheckToFeatureToggleForNotMoldova.sql"/>
    </changeSet>
    <changeSet id="2019-01-22:countryCheckToFeatureToggleForMoldova" author="oleg" context="moldova">
        <sqlFile path="scripts/2019-01-22-countryCheckToFeatureToggleForMoldova.sql"/>
    </changeSet>
    <changeSet id="2019-01-22:countryCheckToFeatureToggleForMoldovaAndAlbania" author="oleg" context="moldova,albania">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('car', 'validateCarRegDocNr', 'Validate car reg doc nr');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'enableAutoApprove', 'Enable auto approve');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setPayOutToPostaAndPartnerOfficeType', 'Set pay out to posta and partner office type');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>
    <changeSet id="2019-01-22:countryCheckToFeatureToggleForKosovoAndMacedonia" author="oleg" context="kosovo,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('car', 'validateCarRegDocNr', 'Validate car reg doc nr');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'enableAutoApprove', 'Enable auto approve');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setPayOutToPostaAndPartnerOfficeType', 'Set pay out to posta and partner office type');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-02-04:countryCheckToFeatureToggleForMoldovaJsp" author="oleg" context="moldova">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showEmployerEstablishedField', 'Show employer established');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showEmployerDirectors', 'Show employer directors');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showAgriculturalIncome', 'Show agricultural income');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showAgriculturalAssets', 'Show agricultural assets');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'showPrecontractUrl', 'Show precontract url');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showClientLanguageField', 'Show client language field');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showOtherTotalDebtField', 'Show other total debt field');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'searchActiveIncomeCallEnabled', 'Search active income call enabled');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'clientHomeTownAutocompleteEnabled', 'Client hometown autocomplete enabled');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('car', 'isCarSectionReadOnly', 'Enable car section read only');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>
    <changeSet id="2019-02-04:countryCheckToFeatureToggleForNotMoldovaJsp" author="oleg" context="albania,kosovo,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showEmployerEstablishedField', 'Show employer established');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showEmployerDirectors', 'Show employer directors');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showAgriculturalIncome', 'Show agricultural income');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showAgriculturalAssets', 'Show agricultural assets');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'showPrecontractUrl', 'Show precontract url');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showClientLanguageField', 'Show client language field');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showOtherTotalDebtField', 'Show other total debt field');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'searchActiveIncomeCallEnabled', 'Search active income call enabled');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'clientHomeTownAutocompleteEnabled', 'Client hometown autocomplete enabled');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('car', 'isCarSectionReadOnly', 'Enable car section read only');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-01-22:countryCheckToFeatureToggleFixMoldova" author="oleg" context="moldova">
        <sql>
            update property set boolean_value = false where country_config_id = (select id from country_configuration where property = 'loanAppRequiresIdCopyAndDataVerification');
        </sql>
    </changeSet>

    <changeSet id="2019-01-22:countryCheckToFeatureToggleFixNotMoldova" author="oleg" context="albania,macedonia,kosovo">
        <sql>
            update property set boolean_value = true where country_config_id = (select id from country_configuration where property = 'loanAppRequiresIdCopyAndDataVerification');
        </sql>
    </changeSet>

    <changeSet id="2019-01-22:client-languages-as-country-configurations" author="ivar">
        <comment>CRA-672 Add languages, that can be assigned to customers</comment>
        <sql>
            INSERT INTO country_configuration (property, property_group, description) VALUES ('english', 'client_language', 'English');
            INSERT INTO country_configuration (property, property_group, description) VALUES ('albanian', 'client_language', 'Albanian');
            INSERT INTO country_configuration (property, property_group, description) VALUES ('romanian', 'client_language', 'Romanian');
            INSERT INTO country_configuration (property, property_group, description) VALUES ('russian', 'client_language', 'Russian');
            INSERT INTO country_configuration (property, property_group, description) VALUES ('macedonian', 'client_language', 'Macedonian');
            INSERT INTO country_configuration (property, property_group, description) VALUES ('serbian', 'client_language', 'Serbian');
        </sql>
    </changeSet>

    <changeSet id="2019-01-22:client-languages-moldova-values" author="ivar" context="moldova">
        <comment>CRA-672 Add languages, that can be assigned to customers</comment>
        <sql>insert into property (country_config_id, type, boolean_value, long_value)
            values
            ((select id from country_configuration where property_group = 'client_language' and property = 'english'), 'boolean', true, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'albanian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'romanian'), 'boolean', true, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'russian' ), 'boolean', true, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'macedonian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'serbian'), 'boolean', false, null)
        </sql>
    </changeSet>

    <changeSet id="2019-02-05:CRM-672-moved-sms-messages-to-doc-template" author="ivar">
        <sql>
            <![CDATA[
            INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>The signing of the contract was unsuccessful. Insert the new code [code].</p>',
                 now(), 'Signing unsuccesful sms', 'eng', 'signing_unsuccessful_first_sms', 'sms_legacy'),
                ('<p>Potpisuvanjeto na Dogovorot e neuspesno. Vnesete nov kod. [code]</p>',
                 now(), 'Signing unsuccesful sms', 'mac', 'signing_unsuccessful_first_sms', 'sms_legacy'),
                ('<p>The signing of the contract was unsuccessful. Please contact IUTECREDIT at 02 3149 999.</p>',
                 now(), 'Signing aborted sms', 'eng', 'signing_unsuccessful_second_sms', 'sms_legacy'),
                ('<p>Potpisuvanjeto na Dogovorot e neuspesno. Ve molime javete se vo IuteCredit na 02 3149 999.</p>',
                 now(), 'Signing aborted sms', 'mac', 'signing_unsuccessful_second_sms', 'sms_legacy'),
                ('<p>Format soobshenija nepriznannyi. Dopolnitelnaia informatsia po telefonu 022801500.</p>',
                 now(), 'Wrong format sms', 'rus', 'wrong_format_sms', 'sms_legacy'),
                ('<p>Unrecognized message format. Please call 022801500 for any additional info.</p>',
                 now(), 'Wrong format sms', 'eng', 'wrong_format_sms', 'sms_legacy'),
                ('<p>Formati i mesazhit tuaj nuk eshte i sakte. Ju lutem telefononi 038406080 per me shume informacion</p>',
                 now(), 'Wrong format sms', 'alb', 'wrong_format_sms', 'sms_legacy'),
                ('<p>Formatul mesajului este gresit. Pentru suport apelati 022801500</p>',
                 now(), 'Wrong format sms', 'rom', 'wrong_format_sms', 'sms_legacy'),
                ('<p>Kredia juaj u aprovua. Tani mund te firmosni marreveshjen e kredise nr. [ref_nr]</p>',
                 now(), 'Posta accepted sms', 'alb', 'posta_accepted_sms', 'sms_legacy'),
                ('<p>Your loan application was approved. You can now sign the loan agreement nr. [ref_nr]</p>',
                 now(), 'Posta accepted sms', 'eng', 'posta_accepted_sms', 'sms_legacy'),
                ('<p>Cererea Dvs de credit a fost aprobata. Va rugam sa semnati contractul de imprumut nr.[ref_nr]</p>',
                 now(), 'Posta accepted sms', 'rom', 'posta_accepted_sms', 'sms_legacy'),
                ('<p>Vash kredit byl odobren. Prosim vas podpisati gogovor zaima nomer [ref_nr]</p>',
                 now(), 'Posta accepted sms', 'rus', 'posta_accepted_sms', 'sms_legacy'),
                ('<p>Ju tani mund ti terhiqni parate ne zyren postare. Numri i kredise suaj eshte  [ref_nr]</p>',
                 now(), 'Posta paid out sms', 'alb', 'posta_paid_out_sms', 'sms_legacy'),
                ('<p>You can now pick-up your money at postal offie. Your loan agreement number is [ref_nr]</p>',
                 now(), 'Posta paid out sms', 'eng', 'posta_paid_out_sms', 'sms_legacy'),
                ('<p>Puteti primi suma imprumutului la oficiul postal. Numarul contractului Dvs este [ref_nr]</p>',
                 now(), 'Posta paid out sms', 'rom', 'posta_paid_out_sms', 'sms_legacy'),
                ('<p>Vy mojete poluchiti summu kredita v pochtovom otdelenii. Nomer vashego dogovora [ref_nr]</p>',
                 now(), 'Posta paid out sms', 'rus', 'posta_paid_out_sms', 'sms_legacy'),
                ('<p>Your loan application [ref_nr] was approved, loan amount [loan_amount] mdl, loan duration [loan_period] months, monthly payback is [monthly_payment] mdl, you have to make [loan_period] equal repayments from [first_repayment] until [last_repayment], annual interest rate [interest_rate], loan commission fee is [commission_fee] mdl, monthly guarantee fee is [monthly_guarantee_fee] mdl, total loan cost is [total_loan] mdl, APR = [apr_rate]%, you have the right to resign the loan agreement during 14 days from its issuance. To accept the loan terms please send YES to 5588.</p>',
                 now(), 'Loan approved remote signing guarantee sms', 'eng', 'approve_distance_signing_guarantee_sms', 'sms_legacy'),
                ('<p>Your loan application [ref_nr] was approved, loan amount [loan_amount] mdl, loan duration [loan_period] months, monthly payback is [monthly_payment] mdl, you have to make [loan_period] equal repayments from [first_repayment] until [last_repayment], annual interest rate [interest_rate], loan commission fee is [commission_fee] mdl, total loan cost is [total_loan] mdl, APR = [apr_rate]%, you have the right to resign the loan agreement during 14 days from its issuance. To accept the loan terms please send YES to 5588.</p>',
                 now(), 'Loan approved remote signing sms', 'eng', 'approve_distance_signing_sms', 'sms_legacy'),
                ('<p>Vasha zaiavka na zaim nr. [ref_nr] byla odobrena, summa zaima [loan_amount] lei, srok zaima [loan_period] mesiatsev, platej po zaimu [monthly_payment] lei, vy doljny vnesti [loan_period] ravnyh platejei nachinaia s [first_repayment] i zakanchivaia [last_repayment], godovaia stavka [interest_rate], platej za protessirovanie [commission_fee] lei, garantiinyi komission [monthly_guarantee_fee] lei/mesiats, obshaia stoimosti zaima [total_loan] lei, DAE=[apr_rate]%, vy imeete pravo otozvati dogovor zaima v techenii 14 dnei s momenta podpisania dogovora. Dlia priniatia etih uslovii i poluchenia zaima otpravite slovo DA na nomer 5588.</p>',
                 now(), 'Loan approved remote signing guarantee sms', 'rus', 'approve_distance_signing_guarantee_sms', 'sms_legacy'),
                ('<p>Vasha zaiavka na zaim nr. [ref_nr] byla odobrena, summa zaima [loan_amount] lei, srok zaima [loan_period] mesiatsev, platej po zaimu [monthly_payment] lei, vy doljny vnesti [loan_period] ravnyh platejei nachinaia s [first_repayment] i zakanchivaia [last_repayment], godovaia stavka [interest_rate], platej za protessirovanie [commission_fee] lei, obshaia stoimosti zaima [total_loan] lei, SGPS=[apr_rate]%, vy imeete pravo otozvati dogovor zaima v techenii 14 dnei s momenta podpisania dogovora. Dlia priniatia etih uslovii i poluchenia zaima otpravite slovo DA na nomer 5588.</p>',
                 now(), 'Loan approved remote signing sms', 'rus', 'approve_distance_signing_sms', 'sms_legacy'),
                ('<p>Cererea dvs de imprumut nr. [ref_nr] a fost aprobata, suma imprumut [loan_amount] lei, durata imprumutului [loan_period] luni, plata lunara este [monthly_payment] lei, aveti de facut [loan_period] plati egale de la data de [first_repayment] pana la data de [last_repayment], dobanda anuala [interest_rate], taxa aferenta contractului [commission_fee] lei, comision lunar de garantie [monthly_guarantee_fee] lei, costul total al imprumutului este [total_loan] lei, DAE=[apr_rate]%, aveti dreptul sa revocati contractul de imprumut timp de 14 zile din momentul semnarii. Pentru a accepta aceste conditii si a primi imprumutul expediati DA la numarul 5588.</p>',
                 now(), 'Loan approved remote signing guarantee sms', 'rom', 'approve_distance_signing_guarantee_sms', 'sms_legacy'),
                ('<p>Cererea dvs de imprumut nr. [ref_nr] a fost aprobata, suma imprumut [loan_amount] lei, durata imprumutului [loan_period] luni, plata lunara este [monthly_payment] lei, aveti de facut [loan_period] plati egale de la data de [first_repayment] pana la data de [last_repayment], dobanda anuala [interest_rate], taxa aferenta contractului [commission_fee] lei, costul total al imprumutului este [total_loan] lei, DAE=[apr_rate]%, aveti dreptul sa revocati contractul de imprumut timp de 14 zile din momentul semnarii. Pentru a accepta aceste conditii si a primi imprumutul expediati DA la numarul 5588.</p>',
                 now(), 'Loan approved remote signing sms', 'rom', 'approve_distance_signing_sms', 'sms_legacy'),

                ('<p>Vash platej po kreditu byl snijen na [sum] [currency]. Summa k oplate na [expected_date] sostavliaet [installment_total] lei. Podrobnosti po tel: 022801500</p>',
                 now(), 'Reduced monthly payments sms', 'rus', 'reduced_monthly_payments_sms', 'sms_legacy'),
                ('<p>Kesti juaj mujor eshte ulur me [sum] [currency].Ju duhet te paguani [installment_total] deri ne [expected_date]. Telefononi 042239111 per detaje.</p>',
                 now(), 'Reduced monthly payments sms', 'alb', 'reduced_monthly_payments_sms', 'sms_legacy'),
                ('<p>Your monthly repayment was reduced with [sum] [currency]. You should pay [installment_total] until [expected_date]. Call 022801500 for details.</p>',
                 now(), 'Reduced monthly payments sms', 'eng', 'reduced_monthly_payments_sms', 'sms_legacy'),
                ('<p>Rata lunara pentru creditul dvs a fost micsorata cu [sum] [currency]. Suma spre achitare la data [expected_date] este de [installment_total]. Detalii 022801500</p>',
                 now(), 'Reduced monthly payments sms', 'rom', 'reduced_monthly_payments_sms', 'sms_legacy'),

                ('<p>You got a [sum] [currency] bonus for recommending us [rec_first_name] [rec_last_name]. Call 022801500 for details.</p>',
                 now(), 'Referral bonus sms', 'eng', 'referral_bonus_sms', 'sms_legacy'),
                ('<p>Ati primit un bonus-reducere in marime de [sum] [currency] pentru clientul recomandat [rec_first_name] [rec_last_name]. Detalii 022801500</p>',
                 now(), 'Referral bonus sms', 'rom', 'referral_bonus_sms', 'sms_legacy'),
                ('<p>Vy poluchili bonus-skidku v razmere [sum] [currency] za rekomendovannogo klienta [rec_first_name] [rec_last_name]. Podrobnosti po tel: 022801500</p>',
                 now(), 'Referral bonus sms', 'rus', 'referral_bonus_sms', 'sms_legacy'),

                ('<p>Amount limit for remote signing is 15.000 mdl. Please call 022801500 to modify your loan application.</p>',
                 now(), 'Sign limit exeeded sms', 'eng', 'sign_limit_exeeded_sms', 'sms_legacy'),

                ('<p>Summa zaima po dogovoru [ref_nr] byla perevedena na vashu bankovskuiu kartu. Vy mojete poluchiti denghi v liubom bankomate v Moldove, bez comisiona.</p>',
                 now(), 'Money transferred to card', 'rus', 'money_transferred_to_card_sms', 'sms_legacy'),
                ('<p>Suma imprumutului conform contractului [ref_nr] a fost depusa pe cardul dvs bancar. Puteti ridica banii fara comision la oricare bancomat in Moldova.</p>',
                 now(), 'Money transferred to card', 'rom', 'money_transferred_to_card_sms', 'sms_legacy'),

                ('<p>SMS signing not allowed</p>',
                 now(), 'Sign not allowed sms', 'eng', 'sign_not_allowed_sms', 'sms_legacy'),
                ('<p>Semnarea prin SMS este interzisa in acest caz</p>',
                 now(), 'Sign not allowed sms', 'rom', 'sign_not_allowed_sms', 'sms_legacy'),
                ('<p>Podpisanie po SMS v dannom sluchaie ne razresheno</p>',
                 now(), 'Sign not allowed sms', 'rus', 'sign_not_allowed_sms', 'sms_legacy');
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2019-02-05:CRM-672-moved-sms-messages-to-doc-template-albania" author="ivar" context="albania">
        <sql>
            <![CDATA[
            INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>Ju keni perfituar nje bonus prej [sum] [currency] duke na rekomanduar [rec_first_name] [rec_last_name]. Telefononi 042239111 per detaje.</p>',
                 now(), 'Reduced monthly payments sms', 'alb', 'referral_bonus_sms', 'sms_legacy');
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2019-02-05:CRM-672-moved-sms-messages-to-doc-template-kosovo" author="ivar" context="kosovo">
        <sql>
            <![CDATA[
            INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
                ('<p>Ju keni perfituar nje bonus prej [sum] [currency] duke na rekomanduar [rec_first_name] [rec_last_name]. Telefononi 038406080 per detaje.</p>',
                 now(), 'Reduced monthly payments sms', 'alb', 'referral_bonus_sms', 'sms_legacy');
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2019-02-11:CRM-672-add-loan-products-to-doc-templates" author="ivar">
        <sql>
            <![CDATA[
            insert into doc_template_loan_product (loan_product_id, template_id)
                select
                    l.id  as loan_product_id,
                    dt.id as template_id
                from loan_products l, doc_template dt
                where dt.created :: date = now() :: date;
            ]]>
        </sql>
    </changeSet>


    <changeSet id="2019-02-12:change-internal-collection-days-md" author="risto" context="moldova">
        <sqlFile path="scripts/CRM-745-new-md-overdue-settings.sql"/>
    </changeSet>

    <changeSet id="2019-02-12:change-internal-collection-days-al" author="risto" context="albania">
        <sqlFile path="scripts/CRM-745-new-al-overdue-settings.sql"/>
    </changeSet>

    <changeSet id="2019-02-12:change-internal-collection-days-ks" author="risto" context="kosovo">
        <sqlFile path="scripts/CRM-745-new-ks-overdue-settings.sql"/>
    </changeSet>

    <changeSet id="2019-02-12:change-internal-collection-days-mk" author="risto" context="macedonia">
        <sqlFile path="scripts/CRM-745-new-mk-overdue-settings.sql"/>
    </changeSet>
    <changeSet id="2019-02-15:client-languages-albania-values" author="ivar" context="albania">
        <comment>CRA-672 Add languages, that can be assigned to customers</comment>
        <sql>insert into property (country_config_id, type, boolean_value, long_value)
            values
            ((select id from country_configuration where property_group = 'client_language' and property = 'english'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'albanian'), 'boolean', true, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'romanian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'russian' ), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'macedonian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'serbian'), 'boolean', false, null)
        </sql>
    </changeSet>

    <changeSet id="2019-02-15:client-languages-kosovo-values" author="ivar" context="kosovo">
        <comment>CRA-672 Add languages, that can be assigned to customers</comment>
        <sql>insert into property (country_config_id, type, boolean_value, long_value)
            values
            ((select id from country_configuration where property_group = 'client_language' and property = 'english'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'albanian'), 'boolean', true, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'romanian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'russian' ), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'macedonian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'serbian'), 'boolean', true, null)
        </sql>
    </changeSet>

    <changeSet id="2019-02-15:client-languages-macedonia-values" author="ivar" context="macedonia">
        <comment>CRA-672 Add languages, that can be assigned to customers</comment>
        <sql>insert into property (country_config_id, type, boolean_value, long_value)
            values
            ((select id from country_configuration where property_group = 'client_language' and property = 'english'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'albanian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'romanian'), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'russian' ), 'boolean', false, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'macedonian'), 'boolean', true, null) ,
            ((select id from country_configuration where property_group = 'client_language' and property = 'serbian'), 'boolean', false, null)
        </sql>
    </changeSet>

    <changeSet id="2019-02-18:client-languages-remove-property" author="ivar">
        <sql>delete from country_configuration where property='showClientLanguageField';</sql>
    </changeSet>


    <changeSet id="2019-02-08:update-albania-basic-entry-max-principal-albania" author="oleg" context="albania">
        <sql>
            update loan_products set max_principal = 20000, min_apr = 201.32, max_apr = 227.4 where name = 'Basic Entry';
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_product', 'returnMaxPrincipal30000ForBasicEntryWithBoaHistory', 'Return max principal 30000 for Basic Entry with BoA history');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-02-08:update-albania-basic-entry-max-principal-not-albania" author="oleg" context="moldova,macedonia,kosovo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_product', 'returnMaxPrincipal30000ForBasicEntryWithBoaHistory', 'Return max principal 30000 for Basic Entry with BoA history');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-02-14:countryCheckToFeatureToggleFixMoldova" author="oleg" context="moldova">
        <sql>
            update property set boolean_value = true where country_config_id = (select id from country_configuration where property = 'enableUpdateAgriculturalAssests');
        </sql>
    </changeSet>

    <changeSet id="2019-02-14:countryCheckToFeatureToggleFixNotMoldova" author="oleg" context="albania,macedonia,kosovo">
        <sql>
            update property set boolean_value = false where country_config_id = (select id from country_configuration where property = 'enableUpdateAgriculturalAssests');
        </sql>
    </changeSet>

    <changeSet id="2019-02-15:countryCheckToFeatureToggleFixMoldova" author="oleg" context="moldova">
        <sql>
            update property set boolean_value = false where country_config_id = (select id from country_configuration where property = 'enableIsShowBankStatement');
        </sql>
    </changeSet>

    <changeSet id="2019-02-15:countryCheckToFeatureToggleFixNotMoldova" author="oleg" context="albania,macedonia,kosovo">
        <sql>
            update property set boolean_value = true where country_config_id = (select id from country_configuration where property = 'enableIsShowBankStatement');
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:CRM-722-add-crk-history" author="risto">
        <addColumn tableName="client_profile">
            <column name="crk_history" type="boolean" defaultValueBoolean="false"></column>
        </addColumn>
    </changeSet>

    <changeSet id="2019-02-27:CRM-722-add-crk-history-submitted-loan" author="risto">
        <addColumn tableName="submitted_loan">
            <column name="crk_history" type="boolean" defaultValueBoolean="false"></column>
        </addColumn>
    </changeSet>

    <changeSet id="2019-02-27:countryCheckCrkHistoryinsert" author="risto">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showCrkHistory', 'Show "CRK history" option on client profile and loan app');
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:countryCrkHistoryMdAlMk" author="risto" context="moldova,albania,macedonia">
        <sql>
            insert into property(country_config_id, type, boolean_value) values ((select id from country_configuration where property = 'showCrkHistory'), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:countryCrkHistoryKs" author="risto" context="kosovo">
        <sql>
            insert into property(country_config_id, type, boolean_value) values ((select id from country_configuration where property = 'showCrkHistory'), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-02-21:CRM-672-added-missing-doc-template-for-money-transferred-to-card" author="ivar">
        <sql>
            <![CDATA[
            INSERT INTO doc_template (content, created, name, lang, type, template_type) VALUES
            ('<p>Money sent to card</p>',
             '2019-02-21'::date, 'Money transferred to card sms (This template content was missing)', 'eng', 'money_transferred_to_card_sms', 'sms_legacy');

            INSERT INTO country_configuration (property, property_group, description) VALUES ('albanian_kosovo', 'client_language', 'Albanian (Kosovo)');
            insert into property (country_config_id, type, boolean_value, long_value)
            values ((select id from country_configuration where property_group = 'client_language' and property = 'albanian_kosovo'), 'boolean', false, null);

            insert into doc_template(content, created, name, lang, type, template_type)
            select content,
                   '2019-02-21'::date,
                   name,
                   'srp',
                   type,
                   template_type
            from doc_template
            where lang = 'eng'
              and template_type = 'sms_legacy';

            insert into doc_template(content, created, name, lang, type, template_type)
            select content,
                   '2019-02-21'::date,
                   name,
                   'xkx',
                   type,
                   template_type
            from doc_template
            where lang = 'eng'
              and template_type = 'sms_legacy';

            insert into doc_template_loan_product (loan_product_id, template_id)
            select l.id  as loan_product_id,
                   dt.id as template_id
            from loan_products l,
                 doc_template dt
            where dt.created :: date = '2019-02-21' :: date;
            ]]>
        </sql>
    </changeSet>

    <changeSet id="2019-02-13:add_custom_advance_payment" author="argo">
        <addColumn tableName="loan_application">
            <column name="use_custom_advance_payment" type="boolean" defaultValueBoolean="false"/>
        </addColumn>
    </changeSet>

    <changeSet id="2019-02-27:countryCheckToFeatureToggleForKosovo" author="oleg" context="kosovo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'validatePartnerOffice', 'Validate partner office');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'isShouldNotCheckFinancialFiles', 'Is should not check financial files');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'enableFinancialFilesUploadForPartners', 'Enable financial files upload for partners');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'getKosovoSpecificCoefsForProvisionReport', 'Get kosovo specific coefs for provision report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'enableMaritalStatusesMarriedDivorcedNotMarried', 'Enable marital statuses MARRIED DIVORCED NOT_MARRIED');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'showBirthPlace', 'Show birth place');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'useDataVerificationV1', 'Use data verification file v1');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'showExportPayments', 'Show export payments');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'showCurrencyRisk', 'Show currency risk');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:countryCheckToFeatureToggleForNotKosovo" author="oleg" context="moldova,albania,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'validatePartnerOffice', 'Validate partner office');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'isShouldNotCheckFinancialFiles', 'Is should not check financial files');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'enableFinancialFilesUploadForPartners', 'Enable financial files upload for partners');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'getKosovoSpecificCoefsForProvisionReport', 'Get kosovo specific coefs for provision report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'enableMaritalStatusesMarriedDivorcedNotMarried', 'Enable marital statuses MARRIED DIVORCED NOT_MARRIED');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'showBirthPlace', 'Show birth place');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'useDataVerificationV1', 'Use data verification file v1');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'showExportPayments', 'Show export payments');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'showCurrencyRisk', 'Show currency risk');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:countryCheckToFeatureToggleForKosovoAndAlbania" author="oleg" context="kosovo,albania">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'isShouldNotCheckOtherFiles', 'Is should not check other files');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'enableFileUploadForPartners', 'Enable file upload for partners');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'enableDocSerialHomePhoneAltContactForPartners', 'Enable doc serial home phone alt contact for partners');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'usePatronymic', 'Use patronymic');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'hideAprInDealerView', 'Hide apr in dealer view');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('files', 'useAlbanianClosureCert', 'Use albanian closure certificate');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('repayment', 'showIuteSumPercentFromCollectionCompanySum', 'Show Iute percent from collection company sum');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'showSmsBalanceLimitAndTaskUser', 'Show sms balance limit and task user');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showNaceReport', 'Show nace report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showNewCollectionsReport', 'Show new collections report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showBankStatementFilterInCpi', 'Show bank statement filter in cpi report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:countryCheckToFeatureToggleForNotKosovoAndAlbania" author="oleg" context="moldova,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'isShouldNotCheckOtherFiles', 'Is should not check other files');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'enableFileUploadForPartners', 'Enable file upload for partners');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('partner', 'enableDocSerialHomePhoneAltContactForPartners', 'Enable doc serial home phone alt contact for partners');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'usePatronymic', 'Use patronymic');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'hideAprInDealerView', 'Hide apr in dealer view');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('files', 'useAlbanianClosureCert', 'Use albanian closure certificate');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('repayment', 'showIuteSumPercentFromCollectionCompanySum', 'Show Iute percent from collection company sum');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'showSmsBalanceLimitAndTaskUser', 'Show sms balance limit and task user');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showNaceReport', 'Show nace report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showNewCollectionsReport', 'Show new collections report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showBankStatementFilterInCpi', 'Show bank statement filter in cpi report');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:countryCheckToFeatureToggleForKosovoAndMacedonia" author="oleg" context="kosovo,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('car', 'isNewFrameAgreementNeededForCarLoan', 'Is new frame agreement needed for car loan');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('installment', 'showMonthlyLabelInInstallmentTable', 'Show monthly label in installment table');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:countryCheckToFeatureToggleForNotKosovoAndMacedonia" author="oleg" context="moldova,albania">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('car', 'isNewFrameAgreementNeededForCarLoan', 'Is new frame agreement needed for car loan');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('installment', 'showMonthlyLabelInInstallmentTable', 'Show monthly label in installment table');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-02-25:add-client-bank-account" author="argo">
        <addColumn tableName="client_profile">
            <column name="bank_account_nr" type="varchar(20)"/>
        </addColumn>
    </changeSet>

    <changeSet id="2019-02-27:make-online-signing-feature-configurable" author="argo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description)
            VALUES ('online-signing', 'onlineSigningEnabled', 'Enable online signing functionality for dealer, e-shop and online partners');

            INSERT INTO property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-02-27:enable-online-signing-for-macedonia" author="argo" context="macedonia">
        <sql>
            UPDATE property set boolean_value = true
            where country_config_id = (select id from country_configuration where property = 'onlineSigningEnabled');
        </sql>
    </changeSet>

    <changeSet id="2019-03-08:add-string-property-type" author="argo">
        <addColumn tableName="property">
            <column name="string_value" type="varchar(250)"/>
        </addColumn>
    </changeSet>

    <changeSet id="2019-03-08:add-property-for-online-signing-code-url" author="argo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description)
            VALUES ('online-signing', 'onlineSigningCodeSubmissionURL', 'Online signing URL where client needs to enter code that was sent with SMS');

            insert into property(country_config_id, type, string_value)
            values ((select max(id) from country_configuration), 'string', '');
        </sql>
    </changeSet>

    <changeSet id="2019-03-08:change-online-signing-url-in-macedonia" author="argo" context="macedonia">
        <sql>
            UPDATE property set string_value = 'https://iutecredit.mk/sign_loan/'
            where country_config_id = (select id from country_configuration where property_group = 'online-signing' and property = 'onlineSigningCodeSubmissionURL');
        </sql>
    </changeSet>



    <changeSet id="2019-03-12:-addUnprovenEmployment" author="ivar">
        <sql>
            INSERT INTO classifier (type, key, value) VALUES ('rejectionReasons', 'unproven_employment', 'Unproven employment');
        </sql>
    </changeSet>

    <changeSet id="2019-03-07:infodebit-debtor-table" author="comul" context="moldova">
        <sql>
            CREATE TABLE infodebit_debtor (
            id                  SERIAL PRIMARY KEY NOT NULL,
            country             VARCHAR(3) NOT NULL,
            client_pin          VARCHAR(50),
            loan_application_id BIGINT,
            fetch_time          TIMESTAMPTZ NOT NULL DEFAULT(current_timestamp AT TIME ZONE 'UTC'),
            debtor_context      JSONB
            );

            CREATE INDEX infodebit_debtor_idnp ON infodebit_debtor ((debtor_context ->> 'debtor_idnp'));
        </sql>
    </changeSet>


    <changeSet id="2019-03-08:countryCheckToFeatureToggleForMacedonia" author="oleg" context="macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('files', 'useMacedonianClosureCert', 'Use albanian closure certificate');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'useDataVerificationV4', 'Use albanian closure certificate');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'useEmail', 'Use email');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showMkbReportInNavigation', 'Show mkb report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setPurposeCarExpenses', 'Set purpose car expenses');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'setUtf8Encoding', 'Set UTF-8 encoding');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'validateEmail', 'Validate email');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'enableKibsValidation', 'Enable KIBS validation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('files', 'alwaysShowBankStatement', 'Always show bank statement');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setAgreementSignmentOnlineOtherwiseOffice', 'Set agreement signment online otherwise office');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setAgreementSignmentOnlineOtherwiseSms', 'Set agreement signment online otherwise sms');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setSigningCodeExpiredOnWithdrawal', 'Set signing code expired on withdrawal');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'sendRejectedEmail', 'Send rejected email');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'setAgreementSignmentOfficeAndLoanPurposeCarExpenses', 'Set agreement signment office and loan purpose car expenses');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-03-08:countryCheckToFeatureToggleForNotMacedonia" author="oleg" context="moldova,albania,kosovo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('files', 'useMacedonianClosureCert', 'Use albanian closure certificate');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'useDataVerificationV4', 'Use albanian closure certificate');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'useEmail', 'Use email');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showMkbReportInNavigation', 'Show mkb report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setPurposeCarExpenses', 'Set purpose car expenses');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('general', 'setUtf8Encoding', 'Set UTF-8 encoding');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'validateEmail', 'Validate email');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'enableKibsValidation', 'Enable KIBS validation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('files', 'alwaysShowBankStatement', 'Always show bank statement');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setAgreementSignmentOnlineOtherwiseOffice', 'Set agreement signment online otherwise office');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setAgreementSignmentOnlineOtherwiseSms', 'Set agreement signment online otherwise sms');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'setSigningCodeExpiredOnWithdrawal', 'Set signing code expired on withdrawal');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('loan_app', 'sendRejectedEmail', 'Send rejected email');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);

            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'setAgreementSignmentOfficeAndLoanPurposeCarExpenses', 'Set agreement signment office and loan purpose car expenses');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-03-08:countryCheckToFeatureToggleForKosovo" author="oleg" context="kosovo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showCrkReportInNavigation', 'Show crk report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-03-08:countryCheckToFeatureToggleForNotKosovo" author="oleg" context="moldova,albania,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showCrkReportInNavigation', 'Show crk report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-03-08:countryCheckToFeatureToggleForAlbania" author="oleg" context="albania">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showCrkReportInNavigation', 'Show crk report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-03-08:countryCheckToFeatureToggleForNotAlbania" author="oleg" context="moldova,kosovo,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showBoaReportInNavigation', 'Show crk report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-03-15:delaerViewAprFixes" author="oleg">
        <sql>
            UPDATE country_configuration SET property = 'hideAprInCarDealerView', description = 'Hide apr in car dealer view' where property = 'hideAprInDealerView';
        </sql>
    </changeSet>

    <changeSet id="2019-03-15:delaerViewAprFixesForKosovoAlbania" author="oleg" context="kosovo,albania">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'hideAprInCashLoansView', 'Hide apr in cash loans view');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-03-15:delaerViewAprFixesForMoldovaMacedonia" author="oleg" context="moldova,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'hideAprInCashLoansView', 'Hide apr in cash loans view');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-03-15:delaerViewAprFixesForNotMoldova" author="oleg" context="macedonia,albania,kosovo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'hideAprInDealerView', 'Hide apr in dealer view');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-03-15:delaerViewAprFixesForMoldova" author="oleg" context="moldova">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('dealer', 'hideAprInDealerView', 'Hide apr in dealer view');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-03-01:allow-multiple-eshop-product-mappings" author="argo">
        <createTable tableName="dealer_eshop_products">
            <column name="id" autoIncrement="true" type="bigint">
                <constraints primaryKey="true" nullable="false"/>
            </column>
            <column name="dealer_id" type="bigint"/>
            <column name="eshop_product_id" type="bigint"/>
        </createTable>

        <sql>
            INSERT INTO dealer_eshop_products (dealer_id, eshop_product_id)
            SELECT id, eshop_product_id
            FROM dealer where eshop_product_id is not null;
        </sql>
    </changeSet>


    <changeSet id="2019-03-13:add-car-pledge-fields-to-country-configuration" author="argo">
        <sql>
            INSERT INTO country_configuration (property_group, property, description)
                VALUES ('mintos', 'pledge.make', 'Prevents car make to be sent to mintos');
            insert into property(country_config_id, type, boolean_value)
                values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description)
                VALUES ('mintos', 'pledge.model', 'Prevents car model to be sent to mintos');
            insert into property(country_config_id, type, boolean_value)
                values ((select max(id) from country_configuration), 'boolean', true);

            INSERT INTO country_configuration (property_group, property, description)
                VALUES ('mintos', 'pledge.year', 'Prevents car year to be sent to mintos');
            insert into property(country_config_id, type, boolean_value)
                values ((select max(id) from country_configuration), 'boolean', true);

            UPDATE country_configuration set description = 'Prevents pledge type to be sent to mintos' where property = 'pledge.type';
        </sql>
    </changeSet>

    <changeSet id="2019-03-20:countryCheckToFeatureToggleForKosovo" author="oleg" context="kosovo">
        <sql>
            delete from country_configuration where property = 'showCrkReportInNavigation' or property = 'showBoaReportInNavigation';
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showCrkReportInNavigation', 'Show crk report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-03-20:countryCheckToFeatureToggleForNotKosovo" author="oleg" context="moldova,albania,macedonia">
        <sql>
            delete from country_configuration where property = 'showCrkReportInNavigation' or property = 'showBoaReportInNavigation';
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showCrkReportInNavigation', 'Show crk report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>

    <changeSet id="2019-03-20:countryCheckToFeatureToggleForAlbania" author="oleg" context="albania">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showBoaReportInNavigation', 'Show boa report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>

    <changeSet id="2019-03-20:countryCheckToFeatureToggleForNotAlbania" author="oleg" context="moldova,kosovo,macedonia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('reports', 'showBoaReportInNavigation', 'Show boa report in navigation');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', false);
        </sql>
    </changeSet>
    
    <changeSet id="2019-03-22:add-raefaes-config" author="argo">
        <insert tableName="country_configuration">
            <column name="property_group" value="partner"></column>
            <column name="property" value="raefaes"></column>
            <column name="description" value="Activates 'raefaes' functionality in CRM"></column>
        </insert>

        <insert tableName="property">
            <column name="type" value="boolean"></column>
            <column name="boolean_value" value="false"></column>
            <column name="country_config_id" valueComputed="(select id from country_configuration where property_group='partner' and property='raefaes')"></column>
        </insert>
    </changeSet>

    <changeSet id="2019-03-23:kosovo-product-copy" author="dmitri" context="kosovo">
        <sqlFile path="scripts/2019-03-23-kosovo-product-copy.sql" splitStatements="false"/>
    </changeSet>

    <changeSet id="2019-04-18:add-client-communication_channel" author="mehmetalp">
        <addColumn tableName="client_profile">
            <column name="communication_channel" type="varchar(20)"/>
        </addColumn>
    </changeSet>

    <changeSet id="2019-04-29:CRM-884-Classifier-Communication-Channel-add" author="mehmetalp">
        <sql>
            INSERT INTO classifier (type, key, value) VALUES ('communicationChannel', 'sms', 'SMS');
            INSERT INTO classifier (type, key, value) VALUES ('communicationChannel', 'viber', 'Viber');
            INSERT INTO classifier (type, key, value) VALUES ('communicationChannel', 'email', 'E-mail');
        </sql>
    </changeSet>

    <changeSet id="2019-06-19:CRM-1663-Classifier-Media-Channel-add" author="mehmetalp">
        <sql>
            INSERT INTO classifier (type, key, value) VALUES ('socialMedia', 'Facebook', 'Facebook');
            INSERT INTO classifier (type, key, value) VALUES ('socialMedia', 'Instagram', 'Instagram');
            INSERT INTO classifier (type, key, value) VALUES ('socialMedia', 'Twitter', 'Twitter');
        </sql>
    </changeSet>

    <changeSet id="2019-06-21:add-social_media_channel" author="mehmetalp">
        <addColumn tableName="client_history">
            <column name="social_media" type="varchar(20)"/>
        </addColumn>
    </changeSet>

    <changeSet id="2019-06-25:showNatiaonalityField" author="mehmetalp" context="bosnia">
        <sql>
            INSERT INTO country_configuration (property_group, property, description) VALUES ('client', 'showNatiaonalityField', 'Show Natiaonality Field');
            insert into property(country_config_id, type, boolean_value) values ((select max(id) from country_configuration), 'boolean', true);
        </sql>
    </changeSet>
    <changeSet id="019-06-25:nationality_add" author="mehmetalp">
        <addColumn tableName="client_profile">
            <column name="nationality" type="varchar(20)"></column>
        </addColumn>
    </changeSet>
</databaseChangeLog>